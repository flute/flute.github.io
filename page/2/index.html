<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Ludis"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Ludis"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="https://ldsun.com/"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://ldsun.com/img/og_image.png"><meta property="article:author" content="Ludis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ldsun.com"},"headline":"Hexo","image":["https://ldsun.com/img/og_image.png"],"author":{"@type":"Person","name":"Ludis"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"https://ldsun.com/img/facvion.png"}},"description":""}</script><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/facvion.png" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/flute"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-01-12T04:26:58.000Z" title="1/12/2019, 12:26:58 PM">2019-01-12</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-01-14T10:01:47.000Z" title="1/14/2019, 6:01:47 PM">2019-01-14</time></span><span class="level-item">3 minutes read (About 454 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/12/%E7%8B%97%E7%94%9F%E7%AC%AC%E4%B8%80%E7%AF%87%E8%A7%82%E5%89%A7%E6%84%9F%E2%80%94%E2%80%94%E5%A4%A7%E6%B1%9F%E5%A4%A7%E6%B2%B3/">狗生第一篇观剧感——大江大河</a></h1><div class="content"><p>写了小半年的“日记”，实际算不得日记，因为没做到一日一记😂。开始习惯记录平时的所想所感。</p>
<p>刚好最近看到为改革开放40年献礼而不失有趣的国产剧《大江大河》，刚看了几眼就觉得此剧值得一看。看的过程中，经常自己抹眼泪😂，真是一个费纸的剧。所以想到可以边看边写一些情感波动和联系到的东西，应该是种不错的体验，所以就有了狗生的第一篇电视剧观看历程。（出于时间考虑，前25集1.5倍速观看，后面的2倍速观看。发现效果很不错）</p>
<p>导演真的太敬业了，此剧以上世纪七八十年代农村为主场景，从农村长大的我，剧中好多的场景，物件，人设，真的是一看就立马回到小时候的记忆，真棒👍。</p>
<blockquote>
<p>人们成熟之后，最节俭的，不是金钱，而是情感，自己很少用，也不向别人索取。只存不取，攒得多了，偶尔在遇见一部电影，一首老歌的时候，倾泄而出。</p>
</blockquote>
<blockquote>
<p>——《半山文集》</p>
</blockquote>
<p>不说了，上笔记。</p>
<p><img src="http://ludis-1252396698.picbj.myqcloud.com/ghost/dajiangdahe/01.jpg!ghost"></p>
<p><img src="http://ludis-1252396698.picbj.myqcloud.com/ghost/dajiangdahe/02.jpg!ghost"></p>
<p><img src="http://ludis-1252396698.picbj.myqcloud.com/ghost/dajiangdahe/03.jpg!ghost"></p>
<p><img src="http://ludis-1252396698.picbj.myqcloud.com/ghost/dajiangdahe/04.jpg!ghost"></p>
<p><img src="http://ludis-1252396698.picbj.myqcloud.com/ghost/dajiangdahe/05.jpg!ghost"></p>
<p>这几天撸铁撸得有点过了，麒麟臂疼得不行，不码字了。最后以东宝书记的三轮车结束吧，快上车。</p>
<p><img src="https://ludis-1252396698.picbj.myqcloud.com/ghost/dajiangdahe/car.jpg!ghost"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-01-01T05:00:57.000Z" title="1/1/2019, 1:00:57 PM">2019-01-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-06T14:24:06.000Z" title="2/6/2019, 10:24:06 PM">2019-02-06</time></span><span class="level-item">13 minutes read (About 1895 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/01/2018-2019/">2018-2019</a></h1><div class="content"><p>今年过得好快鸭🦆。来个<del>日常</del>年常简短总结。</p>
<p>今年也算是一个小的里程碑，在某些方面有了一些大的变化。值得庆祝。</p>
<p>在工作上，一直积极关注学习新的东西。16年刚毕业的一年，从前端到Node后端，到使用Vue，RN，Electron等开启全栈之路，开拓了较广的技术栈。到17年紧跟“潮流”，去做了半年多的小程序全栈，同时巩固了后端开发。至此貌似大前端的大多数东西都已经有过开发经验，勉强算的上伪全栈。作为一个好奇的人，从17年就开始关注区块链技术，入了币圈。并在17年底心血来潮，来了一波说走就走的裸辞，还拉上<del>了几个垫背的</del>几个好机油，一起拥抱百年一遇的<del>泡沫狂欢</del>技术革命。</p>
<p>事实上回头来看，这种<del>骚操作</del>果敢，带来的收益是极大的，年轻就要醒着拼。我不知道当初选择继续原公司的工作，现在是什么样。但裸辞后全身心投入区块链的学习，学go，学以太坊，学合约等等，学习过程中结识了很多优秀的人，来自各行各业的，有年薪百万的大佬，有清华的投行高材生，有手握矿机的<del>机霸</del>矿霸，有还在学校的大四学生，有以卡还卡的套现大佬，有出口成章的演讲家。大家聚在一起享受币圈的狂欢的同时，一起学习进步，真的是学到了很多东西。第一次步入这样一个个体差异极大的群体，真的是从每个人身上学到很多，受益匪浅。</p>
<p>蝴蝶效应，正是当初说走就走的裸辞，带来了结果颇丰的一年。</p>
<ul>
<li>首先是年薪完成了double，来到了一个不错的新集体中，结识了一群新的nice的同事，身边好多大厂出身的大佬，可以耳濡目染。</li>
<li>在这半年中也享受了泡沫带来的狂欢，也经历了账户余额日浮动达到六位数的体验，价值观，投资观念显著升级。人常说币圈一年人间十年，一点也不夸张，收获许多宝贵的经历。</li>
<li>同时开发了币圈的第一个以太坊小程序钱包，脑洞大开的加入了币红包功能，这也是目前为止最得意的一款产品。虽然现在被微信封了，但一个普通人，当有一天你发现你做的东西是这个领域的第一个时，这种成就感真爽。上线首日在币圈群里疯狂传播，大家完的不亦乐乎，赞不绝口。同时好几位大佬投来橄榄枝，虽然最终都没去。这可能是遗憾的一个点，如果视野再宽广点，想的再多点，把产品打磨升级，以当时的状况，在币圈融资不是不可能。其次投来的橄榄枝没有认真对待，不然现在可能都会是不同的结局。不过人生就是这样，你永远不知道那个选择是做好的。总的来时，快速学习掌握新技术，你就可以在新的领域做那个NO1。另外成就感可能是人达到高潮的另一种手段，而且是持续高潮。</li>
<li>还有，就是买了矿机挖矿，之前都是用1070显卡挖的。心血来潮花了五六万买了几台BTM矿机，挖了小一个月体验了一把。中途还被朝阳群众和辅警各种上门问询233。也是很棒的一个体验。</li>
<li>飘逸的长发也建成了寸头，用了一年的发胶发蜡扔掉了，自行理发一年后，现在开始去理发店了，而且基本上三周就去一次。人就是这样，没自己经历过的东西，别人说再多你也不会打心里认可，当自己留了辫子，留了长发，用了发胶，酷了一年之后，就会发现短发其实也不错，更舒服。</li>
<li>之前一直鄙视皮鞋的我，竟然爱上了马丁靴，买了人生第一个皮靴，虽然刚开始穿挺累的，但还挺好看的哈哈哈。真是不同时段有不同的审美。</li>
<li>最重要的，这一年没得啥病，健健康康。热领庆祝体重终于接近140斤，现在跟身高可以说很搭了，体重指数21.22，简直完美。对了，就是后半年脸上长痘消不下去，导致的后果就是大家都以为我是80后 = =，看上去老成是种怎样的体验……</li>
<li>打了几个月的乒乓球，遇到一个旗鼓相当的对手，不加班的时候每天抽几个小时，打的香汗淋漓，爽！想当年驰骋高中的削球手又回来了😏</li>
<li>这半年的厨艺也小有进步吧，就像是从初级转中级了一样，做菜时的心态稳的一批。</li>
<li>参加了很多的聚会。以前是能避则避，过去一年，不管是家族的，朋友的，有尽量参加，其实没那么糟。</li>
<li>开始主动和妹子说话聊天，这项弱势技能需要锻炼一下了。</li>
<li>买了几种乐器，慢慢练练，应该是项不错的技能。</li>
<li>对了，看了超级多的电影、纪录片，这一年真的是把电影看下了，各种类型的，还有好几个动漫、国产剧。影视源于作品，源于生活。书以历史地理心理学为主，为闲暇时间增加很多乐趣。</li>
<li>学本学到一半，来年赶紧学完得了…车放着没人开也是糟心🌚只后悔当初没早点学了。</li>
<li>最后，恭喜IG夺冠，虽然不是我心心念的OMG，但是毕竟从大一到现在六年的时间，带给了很多欢乐。虽然现在玩的越来越少了，但真的好像青春有个明显的结束标志了一样。慢慢的发现，有很多东西的快感高于游戏了。</li>
</ul>
<p>就总结这么多吧。2018，不错的一年。</p>
<p>到展望2019年的时候了，按常理需要列个列表了，想了想还是算了。想做、要做的事有很多，需要一个列表来做规划。会列列表的人很多，心里能惦记着的不多，自己知道就行。给别人看的不叫计划，自己有期待就行。</p>
<p>祝大家新年快乐，新的一年首先强食自爱，其次奋不顾身，同时保持璞玉浑金。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-12-13T08:43:29.000Z" title="12/13/2018, 4:43:29 PM">2018-12-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-01-14T10:02:43.000Z" title="1/14/2019, 6:02:43 PM">2019-01-14</time></span><span class="level-item">9 minutes read (About 1417 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/12/13/%E5%9B%BE%E5%BA%8A%E4%BB%8E%E4%B8%83%E7%89%9B%E8%BF%81%E7%A7%BB%E8%87%B3%E8%85%BE%E8%AE%AFCOS/">图床从七牛迁移至腾讯COS</a></h1><div class="content"><p><strong>前言（吐槽）：</strong></p>
<p>之前收到邮件，七牛要回收什么测试域名，想着没啥影响。因为我绑定了备案域名。最近突然发现博客好多图片挂了。一看我备案了快五年的域名被取消备案了？？？而且七牛直接把测试域名删了…</p>
<p><img src="http://ludis-1252396698.picbj.myqcloud.com/ghost/beian.jpg!ghost"></p>
<p>我当初注册的就是个人性质博客类网站，五年时间网站一直正常运行，且内容性质从未改变。空壳网站？备案信息不准确？真是睿智 🖕</p>
<p><strong>概览</strong></p>
<p>以下操作在macOS下进行。所有命令的文档请参考<a target="_blank" rel="noopener" href="https://developer.qiniu.com/kodo/tools/1302/qshell">qshell命令列表</a></p>
<p>主要流程： 下载七牛中的所有资源，上传至腾讯COS。由于七牛的测试域名已失效，原空间的资源无法直接下载，所以先新建一个空间（新空间测试域名30天有效期），将旧空间的资源全部转移至新空间，然后从新空间下载所有资源。</p>
<h3 id="一、七牛资源从就空间转移至新空间"><a href="#一、七牛资源从就空间转移至新空间" class="headerlink" title="一、七牛资源从就空间转移至新空间"></a>一、七牛资源从就空间转移至新空间</h3><p>1、下载七牛的命令行工具<a target="_blank" rel="noopener" href="https://developer.qiniu.com/kodo/tools/1302/qshell">qshell</a></p>
<p>2、解压、重命名、赋予qshell运行权限</p>
<p>前往目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd  /Users/ludis/Downloads/qshell-v2.3.4 &amp;&amp; ll</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  qshell-v2.3.4 ll</span><br><span class="line">total 135824</span><br><span class="line">-rwxr-xr-x@ 1 ludis  staff    14M Dec  4 16:19 qshell_darwin_x64</span><br><span class="line">-rwxr-xr-x@ 1 ludis  staff    14M Dec  4 16:19 qshell_linux_x64</span><br><span class="line">-rwxr-xr-x@ 1 ludis  staff    12M Dec  4 16:19 qshell_linux_x86</span><br><span class="line">-rwxr-xr-x@ 1 ludis  staff    14M Dec  4 16:19 qshell_windows_x64.exe</span><br><span class="line">-rwxr-xr-x@ 1 ludis  staff    12M Dec  4 16:19 qshell_windows_x86.exe</span><br><span class="line">➜  qshell-v2.3.4</span><br></pre></td></tr></table></figure>
<p>重命名（可选）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv qshell_darwin_x64 qshell</span><br></pre></td></tr></table></figure>
<p>设置权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x qshell</span><br></pre></td></tr></table></figure>

<p>3、添加七牛账号</p>
<p>前往七牛 -&gt; 个人中心 -&gt; 密钥管理。查看AK、SK。</p>
<p><code>./qshell account [AK] [SK] [账户名(邮箱即可)]</code></p>
<p>4、导出已过期的bucket空间所有文件信息。</p>
<p><code>qshell listbucket A -o A.list.txt</code>  （A为空间名）</p>
<p>5、新建一个空间B，用于将已过期的A空间中的所有文件，转移至新的空间B。（新空间的域名30天有效）注意A、B空间需要在相同的地区才可以。</p>
<p>6、使用<code>awk</code>工具，将A空间的文件列表进行格式化。Mac下自带<code>awk</code>工具，其余平台自行安装。</p>
<p>此时A.list.txt中的内容格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">images/react.png	340793	FoVpVxc12JXJawT0UdkRs7bHm3MS	15192693058673770	image/png	0	</span><br><span class="line">images/watermark.png	11567	FirWtot1NJVL-0bU-9VoN4yeQyLu	15192728052402421	image/png	0	</span><br><span class="line">postbg.jpg	105210	FlBqtLeiA1kTiQxRUSSapLep1utC	15185150032696840	image/jpeg	0	</span><br><span class="line">postcover.jpg	47446	Fltqi_cmpz09x8PV4y1yGYwqW_lr	15185152316033806	image/jpeg	0	</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>使用<code>awk</code>命令格式化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch list.txt</span><br><span class="line">awk &#x27;&#123;print $1&#125;&#x27; A.list.txt &gt; list.txt</span><br></pre></td></tr></table></figure>
<p>这个命令意思是将<code>A.list.txt</code>文件中每行的第一个字段（文件名）分离出来，输出到<code>list.txt</code>文件中。</p>
<p>对应的<code>list.txt</code>格式如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">images/postbg.jpg</span><br><span class="line">images/react.png</span><br><span class="line">images/watermark.png</span><br><span class="line">postbg.jpg	105210</span><br><span class="line">postcover.jpg</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>7、使用命令将A空间中的所有资源批量转移至新空间B中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  qshell-v2.3.4 ./qshell batchcopy A B -i list.txt</span><br><span class="line">&lt;DANGER&gt; Input hejhbd to confirm operation: hejhbd</span><br></pre></td></tr></table></figure>
<p>根据提示输入字符串即可，次数刷新B空间即可看到，所有A空间的内容已经转移到B空间。</p>
<h3 id="二、从七牛批量下载资源"><a href="#二、从七牛批量下载资源" class="headerlink" title="二、从七牛批量下载资源"></a>二、从七牛批量下载资源</h3><p>1、创建下载用的配置文件<code>batch_download.conf</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    // dest_dir 文件储存路径-全路径</span><br><span class="line">    &quot;dest_dir&quot; : &quot;/Users/ludis/Downloads/qshell-v2.3.4/downloads/B&quot;,</span><br><span class="line">    // 新建的空间名-B</span><br><span class="line">    &quot;bucket&quot; : &quot;B&quot;,</span><br><span class="line">    &quot;prefix&quot; : &quot;&quot;,</span><br><span class="line">    &quot;suffixes&quot; : &quot;&quot;,</span><br><span class="line">    // B空间的测试域名</span><br><span class="line">    &quot;cdn_domain&quot; : &quot;http://pji27eyb0.bkt.clouddn.com&quot;,</span><br><span class="line">    &quot;referer&quot; : &quot;&quot;,</span><br><span class="line">    &quot;log_file&quot; : &quot;download.log&quot;,</span><br><span class="line">    &quot;log_level&quot; : &quot;info&quot;,</span><br><span class="line">    &quot;log_rotate&quot; : 1,</span><br><span class="line">    &quot;log_stdout&quot; : false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、下载文件</p>
<p>执行<code>./qshell qdownload -c 10 batch_download.conf</code>。其中<code>-c 10</code>表示可以同时下载10个文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  qshell-v2.3.4 ./qshell qdownload -c 10 batch_download.conf</span><br><span class="line">Writing download log to file download.log</span><br><span class="line"></span><br><span class="line">Downloading 2018-09-26-a0KAWoB.jpg [1/76, 1.3%] ...</span><br><span class="line">Downloading 2018-10-14-15382027090950.jpg [2/76, 2.6%] ...</span><br><span class="line">Downloading 2018-10-14-15394888949656.jpg [3/76, 3.9%] ...</span><br><span class="line">Downloading 2018-10-14-15394889958531.jpg [4/76, 5.3%] ...</span><br><span class="line">Downloading 2018-10-14-15394901705197.jpg [5/76, 6.6%] ...</span><br><span class="line">...</span><br><span class="line">Downloading postbg.jpg [75/76, 98.7%] ...</span><br><span class="line">Downloading postcover.jpg [76/76, 100.0%] ...</span><br><span class="line"></span><br><span class="line">See download log at path download.log</span><br><span class="line">➜  qshell-v2.3.4</span><br></pre></td></tr></table></figure>

<h3 id="三、上传文件至腾讯COS"><a href="#三、上传文件至腾讯COS" class="headerlink" title="三、上传文件至腾讯COS"></a>三、上传文件至腾讯COS</h3><p>此处省略100字，自行注册腾讯云，创建存储空间。<strong>设置空间权限为“公有读私有写”</strong>。</p>
<p>上传资源可以使用网页端或者下载<a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436/11366">工具</a>。</p>
<h3 id="四、旧资源链接替换-重定向"><a href="#四、旧资源链接替换-重定向" class="headerlink" title="四、旧资源链接替换/重定向"></a>四、旧资源链接替换/重定向</h3><p>将资源上传至腾讯COS后，需要将原博客中失效的七牛链接替换为腾讯COS中的链接。不同系统的博客请自行传泽替换方案。替换.md文件中的域名，或从数据库查询替换…</p>
<h3 id="五、图片处理（水印）"><a href="#五、图片处理（水印）" class="headerlink" title="五、图片处理（水印）"></a>五、图片处理（水印）</h3><p>七牛空间存储的图片，可以创建图片处理规则，添加水印、缩放等比较方便。然而在腾讯COS存储中没有找到相关配置项。</p>
<p>搜索发现，腾讯的图片处理，统一使用“数据万象”这个单独的应用。在COS创建完存储空间；然后在“数据万象”创建自定义的图片处理规则，并绑定COS存储空间的Bucket即可。且有个优点是可以使用别名代替处理规则，以及可以使用<code>-(中划线) _(下划线) /(斜杠) !(感叹号)</code>四中分割符号。</p>
<p>例如：</p>
<ul>
<li><p>图片链接： <code>https://233.com/666.png</code></p>
</li>
<li><p>如创建的图片规则为： <code>imageMogr2/interlace/0|watermark/1/image/aHR0cDovL3dhdGVybWFyay1iai0xMjUyMTA2MjExLnBpY2JqLm15cWNsb3VkLmNvbS9sdWRpcy0...</code></p>
</li>
<li><p>别名为： <code>imgRule</code></p>
</li>
</ul>
<p>以七牛的尿性图片添加完规则变成： <code>https://233.com/666.png?imageMogr2/interlace/0|watermark/1/image/aHR0cDovL3dhdGVybWFyay1iai0xMjUyMTA2MjExLnBpY2JqLm15cWNsb3VkLmNvbS9sdWRpcy0...</code> 👎</p>
<p>腾讯云则很优雅： <code>https://233.com/666.png!imgRule</code> 👏</p>
<p><a target="_blank" rel="noopener" href="http://robotkang.cc/2018/11/pic/">参考</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-12-03T07:58:55.000Z" title="12/3/2018, 3:58:55 PM">2018-12-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-01-14T10:03:21.000Z" title="1/14/2019, 6:03:21 PM">2019-01-14</time></span><span class="level-item">14 minutes read (About 2083 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/12/03/%E3%80%90%E8%AF%91%E3%80%91%E5%A6%82%E4%B8%9D%E8%88%AC%E9%A1%BA%E6%BB%91-%E4%BD%BF%E7%94%A8css3%E5%AE%9E%E7%8E%B060%E5%B8%A7%E7%9A%84%E5%8A%A8%E7%94%BB/">【译】如丝般顺滑-使用css3实现60帧的动画</a></h1><div class="content"><p>原文： <a target="_blank" rel="noopener" href="https://medium.com/outsystems-experts/how-to-achieve-60-fps-animations-with-css3-db7b98610108?token=_nkJA9ueKgqhc0w5">Smooth as Butter: Achieving 60 FPS Animations with CSS3</a></p><p>在移动端上实现动画很简单。</p><p>如果采取我们的建议的话，在移动端正确的实现动画也会比较容易。</p><p>虽然现在很多人在手机上运用CSS3动画，但许多人用的都不够恰当。很多应加以考虑的最佳实践常常被忽略，因为仍然有人不明白这些最佳实践的真正意义。</p><p>如今有这么多的设备规范，如果还不有针对性地优化你的代码，糟糕的用户体验将让你死无葬身之地。</p><p>记住：虽然市场上始终有一些高端的旗舰机在挑战性能极限，但你面对的仍将是和这些性能怪兽相比只是玩具一样的低端设备。</p><p>我们想帮助你正确地驾驭 CSS3。首先先要了解几件事。</p><h4 id="-">理解时间轴</h4><p>当渲染和处理HTML元素时，浏览器做了什么？这个非常简单的时间轴我们称之为 <strong>关键渲染路径</strong></p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*gMqY9IVJXuBbE8DF." class="kg-image"></figure><!--kg-card-end: image--><p>想要达到流畅的动画效果，我们需要关注修改属性会对 composite （合成）阶段造成怎样的影响。而不是去关注前面的其他阶段。</p><h5 id="1-styles">1. Styles</h5><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*LDiyh_mOgH1n21wF." class="kg-image"></figure><!--kg-card-end: image--><p>浏览器开始计算样式以应用在元素上——重新计算样式</p><h5 id="2-layout">2. Layout</h5><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*X_6VTAJuRQCt1qXM." class="kg-image"></figure><!--kg-card-end: image--><p>接下来，浏览器会开始为每个元素生成用于布局的形状和位置信息。在该步骤浏览器会设置的页面属性包括 <code>width</code>和<code>height</code>，还有<code>margin</code>，以及<code>left/top/right/bottom</code> 等。</p><h5 id="3-paint">3. Paint</h5><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*wJKTvKHyYi13kPoI." class="kg-image"></figure><!--kg-card-end: image--><p>在该步骤，浏览器开始用像素渲染填充每个元素，此时用到的属性有 <code>box-shadown</code>, <code>border-radius</code>,<code>color</code>, <code>background-color</code> 等。</p><h5 id="4-composite">4. Composite</h5><p>这步就是你施展拳脚的地方了，浏览器开始在屏幕上渲染所有的元素。</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*JHTvclhMvkYYEBEY." class="kg-image"></figure><!--kg-card-end: image--><p>现代浏览器可以使用<code>transform</code>和<code>opacity</code>属性很好的实现四种动画。</p><ul><li>位置 —— transform: transformX(n) transformY(n) translateZ(n);</li><li>缩放 —— transform: scale(n);</li><li>旋转 —— rotate(ndeg);</li><li>透明 —— opacity:n;</li></ul><h4 id="-60-">如何达到每秒60帧</h4><p>想法有了，可以撸起袖子干活了。</p><p>首先从HTML开始，创建一个简单的结构，把类名为<code>app-menu</code>的元素放在一个类名为<code>layout</code>的元素中。</p><!--kg-card-begin: code--><pre><code>&lt;div class="layout"&gt;
    &lt;div class="app-menu"&gt;&lt;/div&gt;
    &lt;div class="header"&gt;
        &lt;div class="menu-icon"&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre><!--kg-card-end: code--><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*rXGvLKSlZGRmz4Jd." class="kg-image"></figure><!--kg-card-end: image--><h4 id="--1">用错误的方法来实现这个效果</h4>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: left <span class="number">300ms</span> linear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.app-menu-open</span> <span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: left <span class="number">300ms</span> linear;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看见我们这些我们修改的属性了吗？我们应该避免使用<code>left/top/right/bottom</code>这些属性作为动画。这些属性不能实现流畅的动画，因为他们会让浏览器每次都创建布局，而这会影响他们的子元素。</p><p>这样做的结果大概是这样的：</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*ZWyuzfeBSbFbQjOy." class="kg-image"></figure><!--kg-card-end: image--><p>这个动画一点都不流畅。我们使用开发者工具的时间轴来看看发生了什么，结果如下：</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*y6jExBTCikGX2hVC." class="kg-image"></figure><!--kg-card-end: image--><p>这清楚地显示了FPS是不平整的并且表现也很慢。</p><blockquote>绿色的条代表FPS，高的条表示动画渲染的帧数达到60FPS。低的条表示小于60帧。所以理想情况下，你想让绿色的长条贯穿整个时间轴。红色的条代表着糟糕的性能，所以另一方面评估程序的方法是消除这些红色的条。</blockquote><h4 id="-transform">使用 Transform</h4>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">	-webkit-<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">			<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">	<span class="attribute">transition</span>: transform <span class="number">300ms</span> linear;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.app-menu-open</span> <span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">	-webkit-<span class="attribute">transform</span>: none;</span><br><span class="line">			<span class="attribute">transform</span>: none;</span><br><span class="line">	<span class="attribute">transition</span>: transform <span class="number">300ms</span> linear;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>transform属性影响Composite（合成）属性。这里我们告诉浏览器布局将被渲染并且已经准备好，当动画开始时。所以让渲染动画时卡顿更少。</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*D9YAp9EQwbKunIZ-." class="kg-image"></figure><!--kg-card-end: image--><p>时间轴的显示如下：</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*qc1qxqFudZPYpIUE." class="kg-image"></figure><!--kg-card-end: image--><p>结果变的好点了，FPS更加规律了，因此动画更顺畅了。</p><h4 id="-gpu-">使用GPU运行动画</h4><p>让我们来上升一个等级，准备好让动画变得如丝般顺滑，我们开始使用GPU来渲染动画。</p>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">	-webkit-<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">			<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">	<span class="attribute">transition</span>: transform <span class="number">300ms</span> linear;</span><br><span class="line">	will-change: transform;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然一些浏览器仍然需要 <code>translateZ()</code> 或 <code>translate3d()</code> 作为备选方案，但<code>will-change</code> 被广泛支持已经是势不可挡了。它的功能是把元素提升到另一个层中，这样浏览器就不必关心布局渲染或者绘制了。</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*ZeuG8kachde9iCnR." class="kg-image"></figure><!--kg-card-end: image--><p>看见有多顺畅了吗？ 时间轴目前是这样的：</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*ekofIUN-X7br1bIH." class="kg-image"></figure><!--kg-card-end: image--><p>动画的FPS更稳定了，渲染也更快了。但是有一帧仍然渲染得很久。在开始处还有一点点瓶颈。</p><p>还记得开始时创建的HTML结构吗？让我们来通过JavaScript来控制类名为<code>app-menu</code>的元素。</p>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleClassMenu</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> layout = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.layout&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!layout.classList.contains(<span class="string">&quot;app-menu-open&quot;</span>)) &#123;</span><br><span class="line">    layout.classList.add(<span class="string">&quot;app-menu-open&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    layout.classList.remove(<span class="string">&quot;app-menu-open&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> oppMenu = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.menu-icon&quot;</span>);</span><br><span class="line">oppMenu.addEventListener(<span class="string">&quot;click&quot;</span>, toggleClassMenu, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>这儿的问题是给布局中的div元素增加了类名，这样使得浏览器多了一次重新计算样式的步骤，因此影响了渲染表现。</p><h4 id="-60--1">如丝般顺滑的60帧动画解决方案</h4><p>如果我们在视窗外的区域创建<code>menu</code>元素呢？在脱离主区域的地方这么做，可以确保影响仅限于你想赋予动画的元素。</p><p>因此，我们打算使用下面的HTML结构：</p>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-menu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layout&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>现在我们可以以略微不同的方式来控制菜单的状态。我们可以通过使用JavaScript的<code>transitionend</code>方法，在动画结束时移除类名来控制动画。</p>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleClassMenu</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	myMenu.classList.add(<span class="string">&quot;menu--animatable&quot;</span>);	</span><br><span class="line">	<span class="keyword">if</span>(!myMenu.classList.contains(<span class="string">&quot;menu--visible&quot;</span>)) &#123;		</span><br><span class="line">		myMenu.classList.add(<span class="string">&quot;menu--visible&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		myMenu.classList.remove(<span class="string">&#x27;menu--visible&#x27;</span>);		</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OnTransitionEnd</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	myMenu.classList.remove(<span class="string">&quot;menu--animatable&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myMenu = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.menu&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> oppMenu = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.menu-icon&quot;</span>);</span><br><span class="line">myMenu.addEventListener(<span class="string">&quot;transitionend&quot;</span>, OnTransitionEnd, <span class="literal">false</span>);</span><br><span class="line">oppMenu.addEventListener(<span class="string">&quot;click&quot;</span>, toggleClassMenu, <span class="literal">false</span>);</span><br><span class="line">myMenu.addEventListener(<span class="string">&quot;click&quot;</span>, toggleClassMenu, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>我们来整理一下代码然后检查下结果。</p><p>下面是完整的CSS3代码示例：</p>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.menu</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">150</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.menu--visible</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>);</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">103%</span>);</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">103%</span>);</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  will-change: transform;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">160</span>;</span><br><span class="line">  <span class="attribute">pointer-events</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.menu--visible</span> <span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: none;</span><br><span class="line">  <span class="attribute">transform</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.menu--animatable</span> <span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">130ms</span> ease-in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.menu--visible</span><span class="selector-class">.menu--animatable</span> <span class="selector-class">.app-menu</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">330ms</span> ease-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.menu</span>:after &#123;</span><br><span class="line">  content: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  will-change: opacity;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.3s</span> <span class="built_in">cubic-bezier</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.menu--visible</span><span class="selector-class">.menu</span>:after &#123;</span><br><span class="line">  opacity: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">pointer-events</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*EFkarCSe2mQEYK0e." class="kg-image"></figure><!--kg-card-end: image--><p>那么时间轴表现如何呢？</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="https://cdn-images-1.medium.com/max/800/0*mDp5_LD08xtZKQyS." class="kg-image"></figure><!--kg-card-end: image--><p>是不是如丝般顺滑呢？</p><h4 id="--2">翻译总结：</h4><p>目前在给手机页面通过CSS3实现简单动画时，一般很少考虑流畅问题。因为在开发阶段使用的PC机性能都极高，很难主要到这一点。如我目前使用的Mac Pro（i7,16g）。即便使用文中提到的错误示例（第一种方案，通过left控制动画），通过审查工具分析时，其帧数依旧如诗般顺滑...，然而应该当考虑到实际的使用场景是移动端，且就目前而言，确实仍有一大批人在只用较为低端的安卓机。所以采用最佳实践很有必要，并且实际使用的动画会比菜单滑动要复杂。所以是否采取最佳实践方案在实际的设备中运行会出现较大差异。</p></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-10-14T04:42:31.000Z" title="10/14/2018, 12:42:31 PM">2018-10-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2018-12-10T09:16:12.000Z" title="12/10/2018, 5:16:12 PM">2018-12-10</time></span><span class="level-item">6 minutes read (About 864 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/10/14/Mac-Photoshop-2018%EF%BC%88Adobe%E5%85%A8%E5%AE%B6%E6%A1%B6%EF%BC%89%E4%B8%8B%E8%BD%BD%E7%A0%B4%E8%A7%A3/">Mac Photoshop 2018（Adobe全家桶）下载破解</a></h1><div class="content"><p><strong>请支持正版软件！！！</strong></p>
<p>适用于Adobe所有软件的安装破解，以 Photoshop 2018 为例。根据电脑语言为中文/英文，安装完的软件自动为中文/英文。</p>
<h3 id="1、下载安装-Adobe-creative-cloud"><a href="#1、下载安装-Adobe-creative-cloud" class="headerlink" title="1、下载安装 Adobe creative cloud"></a>1、下载安装 <code>Adobe creative cloud</code></h3><p>下载地址：<a target="_blank" rel="noopener" href="https://www.adobe.com/creativecloud/desktop-app.html">https://www.adobe.com/creativecloud/desktop-app.html</a></p>
<p>可以理解为Adobe的下载器，可以使用这个下载器下载所有Adobe产品。</p>
<p>下载完成后，选择登陆/注册Adobe账户，然后你就可以看到如下页面：</p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394888949656.jpg?imageMogr2/thumbnail/!50p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<p>而事实上，从官网介绍来看，我们需要的是这样的（Apps页面可下载Adobe的产品）：</p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394889958531.jpg?imageMogr2/thumbnail/!50p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<p>猜测可能是因为注册的账户是天朝或者所在地为天朝的原因，好多功能被屏蔽了，大天朝还真是一枝独秀，且看我手势 🖕</p>
<p>解决方法：</p>
<p>macOS修改 <code>Adobe creative cloud</code> 的配置文件：<code>false</code> 改为 <code>true</code>：</p>
<p><code>sudo vi /Library/Application Support/Adobe/OOBE/Configs/ServiceConfig.xml</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;config&gt;&lt;panel&gt;&lt;name&gt;AppsPanel&lt;/name&gt;&lt;visible&gt;false&lt;/visible&gt;&lt;/panel&gt;&lt;feature&gt;&lt;name&gt;SelfServeInstalls&lt;/name&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/feature&gt;&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;config&gt;&lt;panel&gt;&lt;name&gt;AppsPanel&lt;/name&gt;&lt;visible&gt;true&lt;/visible&gt;&lt;/panel&gt;&lt;feature&gt;&lt;name&gt;SelfServeInstalls&lt;/name&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/feature&gt;&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>然后重启应用后，Apps Tab已经出现，第一步完成。</p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394901705197.jpg?imageMogr2/thumbnail/!50p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<h3 id="2、下载"><a href="#2、下载" class="headerlink" title="2、下载"></a>2、下载</h3><p>在Apps页面选择自己需要的软件下载即可。例如Photoshop</p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394904928259.jpg?imageMogr2/thumbnail/!100p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<h3 id="3、激活"><a href="#3、激活" class="headerlink" title="3、激活"></a>3、激活</h3><p>下载 <a target="_blank" rel="noopener" href="https://www.waitsun.com/adobe-zii-3-0-1.html">Adobe zii</a> 激活软件。此神器适用于所有Adobe产品！！！</p>
<p>在所有软件下载完成后，依次进行以下操作：</p>
<ol>
<li>断网</li>
<li>打开/试用一遍所有需要激活的Adobe产品，然后退出</li>
<li>打开<code>Adobe zii</code>一键激活即可</li>
</ol>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394908693431.jpg?imageMogr2/thumbnail/!50p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394915647166.jpg?imageMogr2/thumbnail/!50p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<p>此时软件已经激活完成，可以正常使用。以下步骤为扩展步骤。</p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394920240861.jpg?imageMogr2/thumbnail/!100p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<h3 id="4、阻止联网监测（非必须）"><a href="#4、阻止联网监测（非必须）" class="headerlink" title="4、阻止联网监测（非必须）"></a>4、阻止联网监测（非必须）</h3><p>此操作是防止有些Adobe产品自行联网检测激活状态，导致激活时效。这么说吧，用了高枕无忧，不用可能会中奖，自行选择。</p>
<p>下载 <a target="_blank" rel="noopener" href="https://www.waitsun.com/little-snitch-4-0-3.html">Little Snitch</a> 防火墙软件，安装后，将一切以Adobe开头的软件全部禁止联网即可。</p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/2018-10-14-15394919377107.jpg?imageMogr2/thumbnail/!100p/blur/1x0/quality/100%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10"></p>
<h3 id="5、软件升级"><a href="#5、软件升级" class="headerlink" title="5、软件升级"></a>5、软件升级</h3><p>如果进行了第四步，那么在升级时先暂停 <code>Little Snitch</code>，先解除联网限制。</p>
<p>然后运行 <code>Adobe Creative Cloud</code> 进行软件升级，会有升级提示。</p>
<p>最后重复激活的步骤即可。</p>
<p>注：<strong>请支持正版软件！！！</strong></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-09-27T11:00:00.000Z" title="9/27/2018, 7:00:00 PM">2018-09-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-01-14T10:05:07.000Z" title="1/14/2019, 6:05:07 PM">2019-01-14</time></span><span class="level-item">12 minutes read (About 1777 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/27/instagram-%E5%86%85%E5%AE%B9%E6%8A%93%E5%8F%96/">instagram 内容抓取</a></h1><div class="content"><h3 id="-">抓取说明</h3><p>1、需要登录信息，即抓取时需要附带<code>cookie</code>，同时需要<code>user-agent</code>。</p><p>2、数据获取接口及下载均有频率限制，无间隔的请求（几百个资源）会被限制，在被限制后睡眠一定时间继续。</p><p>3、内容抓取分为两个入口</p><ul><li>一个是抓取某个用户发布的所有资源</li><li>一个是抓取某个tag下的所有资源</li></ul><p>两种入口附带的cookie不同，请求的URL不同。</p><p>4、抓取步骤：</p><ol><li>电脑端登陆ins，保存 <code>cookie</code>、<code>query_hash</code>、<code>user-agent</code>信息。后续所有请求附带<code>cookie</code>及<code>user-agent</code>。</li><li>模拟请求个人主页/tag主页，通过解析HTML页面，得到userId/tag name。同时拿到第一页的数据及下页cursor。</li><li>通过API接口，根据<code>cursor</code>持续获取多页数据。所有数据获取完毕后开始下载。</li><li>返回的数据中，图片资源可以直接下载。视频资源需要再次请求视频地址获取接口获得视频地址，然后再下载。</li></ol><p>5、请求数据接口：</p><p>user:</p><!--kg-card-begin: code--><pre><code>https://www.instagram.com/graphql/query/?query_hash=a5164aed103f24b03e7b7747a2d94e3c&amp;variables=%7B%22id%22%3A%22%s%22%2C%22first%22%3A$&#123;purePage&#125;%2C%22after%22%3A%22%s%22%7D
</code></pre><!--kg-card-end: code--><p>tag:</p><!--kg-card-begin: code--><pre><code>https://www.instagram.com/graphql/query/?query_hash=1780c1b186e2c37de9f7da95ce41bb67&amp;variables=%7B%22tag_name%22%3A%22%s%22%2C%22first%22%3A$&#123;purePage&#125;%2C%22after%22%3A%22%s%22%7D
</code></pre><!--kg-card-end: code--><p>获取视频的地址:</p><!--kg-card-begin: code--><pre><code>https://www.instagram.com/p/%s/?__a=1
</code></pre><!--kg-card-end: code--><h3 id="--1">核心代码</h3><!--kg-card-begin: code--><pre><code>/**
 * 获取指定用户的主页
 */
const getHtml = item =&gt; &#123;
    let userName = item.name,
        type = item.type
    let url
    if (item.type == 'user') &#123;
        url = `$&#123;baseUrl&#125;$&#123;userName&#125;/`
        headers.cookie = userCookie
    &#125; else &#123;
        url = `$&#123;baseUrl&#125;explore/tags/$&#123;userName&#125;/`
        headers.cookie = tagCookie
    &#125;
    let options = &#123;
        method: 'GET',
        url: url,
        headers: headers
    &#125;

<pre><code>return new Promise((resolve, reject) =&amp;gt; &#123;
    request(options, function (error, response, body) &#123;
        if (error) return reject(error);

        const $ = cheerio.load(body)
        let html = $.html()

        // 获取uid/tag name
        userId = item.type == &#39;user&#39; ? html.match(/&quot;profilePage_([0-9]+)&quot;/)[1] : html.match(/&quot;name&quot;:&quot;([a-zA-Z_]+)&quot;,/)[1]
        log.info(`$&#123;userName&#125; id/name 获取成功 $&#123;userId&#125;`)

        // 获取首页数据
        data = html.match(/&amp;lt;script type=&quot;text\/javascript&quot;&amp;gt;window._sharedData = (.*?);&amp;lt;\/script&amp;gt;/)[1]
        data = JSON.parse(data)

        let edges, count, pageInfo, cursor, flag, totalPage

        let firstPageDate

        if (item.type == &#39;user&#39;) &#123;
            firstPageDate = data.entry_data.ProfilePage[0].graphql.user.edge_owner_to_timeline_media
        &#125; else &#123;
            firstPageDate = data.entry_data.TagPage[0].graphql.hashtag.edge_hashtag_to_media
        &#125;

        edges = firstPageDate.edges
        count = firstPageDate.count
        pageInfo = firstPageDate.page_info

        cursor = pageInfo.end_cursor
        flag = pageInfo.has_next_page
        totalPage = Math.ceil(count / purePage)

        // 存储首页信息
        edges.forEach(item =&amp;gt; &#123;
            item.mode = type
            storeMedia(item)
        &#125;)

        // 返回分页信息
        return resolve(&#123;
            totalPage: totalPage,
            userId: userId,
            cursor: cursor
        &#125;)

    &#125;);
&#125;)
</code></pre>
<p>}</p>
<p>/**</p>
<ul>
<li>获取该用户的所有内容</li>
<li>/<br>const getAllUrls = (item, totalPage, uid, cursor) =&gt; {<br>  let userName = item.name<br>  let actions = [async.constant(item, uid, cursor)]<br>  let limit = totalPage &gt; pageLimit ? pageLimit : totalPage<br>  for (let i = 0; i &lt; limit; i++) {<pre><code>  actions.push(fetchData)
</code></pre>
  }<br>  log.info(<code>$&#123;userName&#125; 数据共 $&#123;totalPage&#125; 页</code>)<br>  return new Promise((resolve, reject) =&gt; {<pre><code>  async.waterfall(actions, (error, result) =&amp;gt; &#123;
      log.info(`$&#123;userName&#125; 的所有帖子数据获取成功，共$&#123;media.length&#125;个帖子，视频$&#123;videoCount&#125;个，图片$&#123;imgCount&#125;个`, )
      fetchPageCount = 0
      //console.log(media)
      return resolve(media)
  &#125;)
</code></pre>
  })</li>
</ul>
<p>}</p>
<p>/**</p>
<ul>
<li><p>请求获取数据</p>
</li>
<li><p>/<br>const fetchData = (item, uid, offset, next) =&gt; {</p>
<p>  let userName = item.name,</p>
<pre><code>  type = item.type
</code></pre>
<p>  let url</p>
<p>  if (item.type == ‘user’) {</p>
<pre><code>  url = util.format(fetchUserUrl, uid, offset)
  headers.cookie = userCookie
</code></pre>
<p>  } else {</p>
<pre><code>  url = util.format(fetchTagUrl, uid, offset)
  headers.cookie = tagCookie
</code></pre>
<p>  }</p>
<p>  let options = {</p>
<pre><code>  method: &#39;GET&#39;,
  url: url,
  headers: headers
</code></pre>
<p>  };</p>
<p>  request(options, function (error, response, body) {</p>
<pre><code>  if (error) &#123;
      log.error(&#39;fetch data error&#39;, error)
      log.info(&#39;休息1min~&#39;)
      return setTimeout(function () &#123;
          return next(null, item, uid, offset)
      &#125;, 1 * 60 * 1000)
  &#125;

  let data
  try &#123;
      data = JSON.parse(body)
  &#125; catch (error) &#123;
      log.error(&#39;json序列化失败&#39;, error)
      return next(null, item, uid, offset) 
  &#125;
  
  if (data.status == &#39;fail&#39;) &#123;
      log.error(&#39;返回内容失败&#39;, data)
      log.info(&#39;休息1min~&#39;)
      //return next(data.message)
      return setTimeout(function () &#123;
          return next(null, item, uid, offset)
      &#125;, 1 * 60 * 1000)
  &#125;

  let listData
  try &#123;
      if (item.type == &#39;user&#39;) &#123;
          listData = data.data.user.edge_owner_to_timeline_media
      &#125; else &#123;
          listData = data.data.hashtag.edge_hashtag_to_media
      &#125;
  &#125; catch (error) &#123;
      log.error(&#39;数据获取失败&#39;, error)
      next(error)
  &#125;

  let edges = listData.edges
  edges.forEach(item =&amp;gt; &#123;
      item.mode = type
      storeMedia(item)
  &#125;)
  let &#123;
      has_next_page,
      end_cursor
  &#125; = listData.page_info

  log.info(`page:$&#123;++fetchPageCount&#125; $&#123;userName&#125; 数据获取成功，帖子 $&#123;edges.length&#125; 个, has_next_page: $&#123;has_next_page&#125; ，end_cursor: $&#123;end_cursor&#125;`)

  if (!has_next_page) &#123;
      return next(&#39;所有数据获取完毕，无下页&#39;)
  &#125;
  setTimeout(function () &#123;
      return next(null, item, uid, end_cursor)
  &#125;, 2000)
</code></pre>
<p>  });</p>
</li>
</ul>
<p>}</p>
<p>/**</p>
<ul>
<li><p>根据视频的shortcode获取视频的下载地址</p>
</li>
<li><p>/<br>const fetchVideoUrl = (mode, shortcode) =&gt; {<br>  let url = util.format(getVideoUrl, shortcode)</p>
<p>  if (mode == ‘user’) {</p>
<pre><code>  headers.cookie = userCookie
</code></pre>
<p>  } else {</p>
<pre><code>  headers.cookie = tagCookie
</code></pre>
<p>  }<br>  let options = {</p>
<pre><code>  method: &#39;GET&#39;,
  url: url,
  headers: headers
</code></pre>
<p>  }<br>  return new Promise((resolve, reject) =&gt; {</p>
<pre><code>  request(options, function (error, response, body) &#123;
      let videoUrl = &#39;&#39;
      if (error) &#123;
          log.error(`获取 $&#123;shortcode&#125; 视频地址失败`, error)
          return resolve(videoUrl)
      &#125;

      try &#123;
          let data = JSON.parse(body)
          videoUrl = data.graphql.shortcode_media.video_url
      &#125; catch (error) &#123;
          log.error(`获取 $&#123;shortcode&#125; videoUrl 为空`)
      &#125;
      return resolve(videoUrl)
  &#125;)
</code></pre>
<p>  })</p>
</li>
</ul>
<p>}</p>
<p>/**</p>
<ul>
<li>根据不同的类型存储数据</li>
<li>/<br>const storeMedia = async item =&gt; {<br>  let result = {<pre><code>  id: item.node.id,
  desc: item.node.edge_media_to_caption.edges[0] ? item.node.edge_media_to_caption.edges[0].node.text : &#39;&#39;
</code></pre>
  }<br>  if (item.node.is_video) {<pre><code>  // video
  // 如果有video_url直接获取
  // 如果没有video_url，通过接口获取
  let videoUrl = item.node.video_url
  if (!videoUrl) videoUrl = await fetchVideoUrl(item.mode, item.node.shortcode)
  if (videoUrl) &#123;
      result.type = &#39;video&#39;
      result.url = videoUrl
      videoCount++
  &#125;
</code></pre>
  } else {<pre><code>  // img
  let imgUrl = item.node.display_url
  if (imgUrl) &#123;
      result.type = &#39;img&#39;
      result.url = imgUrl
      imgCount++
  &#125;
</code></pre>
  }<br>  media.push(result)<br>}</li>
</ul>
<p>/**</p>
<ul>
<li><p>下载视频/图片</p>
</li>
<li><p>/<br>const download = (category, media, next) =&gt; {</p>
<p>  let isExist = isFileExist(media.id)<br>  if (isExist) return next(null)</p>
<p>  let filePath<br>  if (media.type == ‘video’) {</p>
<pre><code>  filePath = `$&#123;videoDlPath&#125;/$&#123;media.id&#125;.mp4`
</code></pre>
<p>  } else if (media.type == ‘img’) {</p>
<pre><code>  filePath = `$&#123;imgDlPath&#125;/$&#123;media.id&#125;.jpg`
</code></pre>
<p>  } else return next(null)</p>
<p>  let st = new Date()<br>  request(media.url)</p>
<pre><code>  .on(&#39;response&#39;, function (res) &#123;
      // create file write stream
      let fws = fs.createWriteStream(filePath);
      // setup piping
      res.pipe(fws);
      // finish
      res.on(&#39;end&#39;, function (e) &#123;
          let et = new Date()
          let ut = timeUsed((et - st) / 1000)
          log.info(`$&#123;videoDl + imgDl&#125; finish download $&#123;category&#125; $&#123;filePath&#125;，用时$&#123;ut&#125;`)
          saveJsonData(media.type, &#123;
              id: media.id,
              category: category,
              desc: media.desc
          &#125;)
          if (media.type == &#39;video&#39;) videoDl++
          else imgDl++

          return next(null)
      &#125;);
      // error handler
      res.on(&#39;error&#39;, err =&amp;gt; &#123;
          log.error(&#39;download error&#39;, err)
          return next(null)
      &#125;)
  &#125;)
  .on(&#39;error&#39;, function (err) &#123;
      log.error(&#39;request source failed&#39;, media.url, err)
      // 大约3分钟可恢复
      log.info(&#39;超频啦！休息1分钟~&#39;)
      setTimeout(function () &#123;
          return next(null)
      &#125;, 1 * 60 * 1000)

  &#125;)
</code></pre>
</li>
</ul>
<p>}</p>
<p>/**</p>
<ul>
<li>视频是否已下载</li>
<li>/<br>const isFileExist = id =&gt; {<br>  let videoPath = <code>$&#123;videoDlPath&#125;/$&#123;id&#125;.mp4</code><br>  let imgPath = <code>$&#123;imgDlPath&#125;/$&#123;id&#125;.jpg</code><br>  if (fs.existsSync(videoPath)) {<pre><code>  log.info(&#39;video file exist&#39;, videoPath)
  return true
</code></pre>
  } else if (fs.existsSync(imgPath)) {<pre><code>  log.info(&#39;img file exist&#39;, imgPath)
  return true
</code></pre>
  } else return false<br>}</li>
</ul>
<p>/**</p>
<ul>
<li><p>视频下载成功后，实时更新json数据。防止程序中途奔溃后视频信息未保存</p>
</li>
<li><p>/<br>const saveJsonData = (type, data) =&gt; {<br>  try {</p>
<pre><code>  // 读取已有json信息
  let jsonFile = type == &#39;video&#39; ? videoJsonPath : imgJsonPath
  jsonFile += `/data.json`

  let jsonData = []
  if (fs.existsSync(jsonFile)) &#123;
      fileData = fs.readFileSync(jsonFile, &#123;
          encoding: &#39;utf8&#39;
      &#125;)
      if (fileData) &#123;
          jsonData = JSON.parse(fileData)
      &#125;
  &#125;
  // 写入
  jsonData.push(data)
  fs.writeFileSync(jsonFile, JSON.stringify(jsonData));
</code></pre>
<p>  } catch (error) {</p>
<pre><code>  log.error(&#39;写入json文件失败&#39;, data)
</code></pre>
<p>  }</p>
</li>
</ul>
<p>}</p>
<p>const clearData = () =&gt; {<br>    media = []<br>    videoCount = 0<br>    imgCount = 0<br>    videoDl = 0<br>    imgDl = 0<br>}</p>
<p>/**</p>
<ul>
<li>下载某用户/标签下获取的所有资源</li>
<li>/<br>const downloadAll = (userName, data) =&gt; {<br>  let dlActions = data.map(item =&gt; next =&gt; {<pre><code>  download(userName, item, next)
</code></pre>
  })<br>  return new Promise((resolve, reject) =&gt; {<pre><code>  async.series(dlActions, (error, result) =&amp;gt; &#123;
      return resolve(result)
  &#125;)
</code></pre>
  })<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>用时显示</li>
<li>/<br>const timeUsed = t =&gt; {<br>  // [1s, 1m)<br>  if (t &lt; 60) return <code>$&#123;Math.ceil(t)&#125;s</code><br>  // [1m, 1h)<br>  else if (t &gt;= 60 &amp;&amp; t &lt; 60 * 60) return <code>$&#123;Math.floor(t/60)&#125;m$&#123;Math.floor(t%60)&#125;s</code><br>  // [1h, 1d)<br>  else if (t &gt;= 60 * 60 &amp;&amp; t &lt; 60 * 60 * 24) return <code>$&#123;Math.floor(t/(60*60))&#125;h$&#123;Math.floor(t%(60*60)/60)&#125;m</code><br>  // [1d, ~)<br>  else return <code>$&#123; Math.floor(t/(24*60*60)) &#125;d $&#123; Math.floor( t%(24*60*60)/(60*60) ) &#125;h</code><br>}</li>
</ul>
<p>/**</p>
<ul>
<li><p>某个用户/标签的抓取任务</p>
</li>
<li><p>/<br>const task = async (item, next) =&gt; {<br>  let userName = item.name</p>
<p>  let {</p>
<pre><code>  totalPage,
  userId,
  cursor
</code></pre>
<p>  } = await getHtml(item).catch(error =&gt; {</p>
<pre><code>  log.error(&#39;fetch error&#39;, error)
  return next(null)
</code></pre>
<p>  })</p>
<p>  let data = await getAllUrls(item, totalPage, userId, cursor)</p>
<p>  clearData()</p>
<p>  let st = new Date()<br>  let download = await downloadAll(userName, data)<br>  let et = new Date()<br>  let ut = timeUsed((et - st) / 1000)<br>  log.info(<code>$&#123;userName&#125; 所有下载完成， video $&#123;videoDl&#125; 个,img $&#123;imgDl&#125; 个,共用时 $&#123;ut&#125;</code>)<br>  clearData()<br>  return next(null)</p>
</li>
</ul>
<p>}</p>
<p>const main = () =&gt; {<br>    let actions = target.map(item =&gt; next =&gt; {<br>        task(item, next)<br>    })<br>    async.series(actions, (error, result) =&gt; {<br>        log.info(<code>所有 $&#123;result.length&#125; 个任务完成</code>, error)<br>        process.exit(0)<br>    })<br>}</p>
<p>main()<br></code></pre><!--kg-card-end: code--><p>完整代码： <a target="_blank" rel="noopener" href="https://github.com/flute/instagram-crawler">https://github.com/flute/instagram-crawler</a></p></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-09-26T11:00:00.000Z" title="9/26/2018, 7:00:00 PM">2018-09-26</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-01-14T10:04:47.000Z" title="1/14/2019, 6:04:47 PM">2019-01-14</time></span><span class="level-item">10 minutes read (About 1453 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/26/coub-com-%E5%86%85%E5%AE%B9%E6%8A%93%E5%8F%96/">coub.com 内容抓取</a></h1><div class="content"><h3 id="-">抓取说明</h3><p>1、总共17个分类。</p><p>2、数据获取</p><ul><li>url：<code>https://coub.com/api/v2/timeline/hot/movies/half?per_page=25</code></li><li>说明：<code>movies</code> 为分类。 <code>per_page</code> 为每页返回的数据量[1,25]。首次获取只需传入 <code>page=1</code> 即为第一页的数据。下次请求附带字段 <code>anchor</code> 为上次请求返回的 <code>next</code> 参数即可。</li></ul><p>3、每个资源的属性：</p><ul><li>唯一标志： id、permalink</li><li>资源描述： titile</li></ul><p>4、下载</p><p>coub.com的音频和视频是分开的，下载的时候需要将音视频分别下载，然后使用FFmpeg合并。<br>下载及合并使用开源项目 <code>https://github.com/TeeSeal/coub-dl</code></p><p>5、分类数组</p><!--kg-card-begin: code--><pre><code>["animals-pets", "mashup", "anime", "movies", "gaming", "cartoons", "art", "music", "sports", "science-technology", "celebrity", "nature-travel", "fashion", "dance", "cars", "nsfw"]
</code></pre><!--kg-card-end: code--><h3 id="--1">核心代码：</h3><!--kg-card-begin: code--><pre><code>/**
 * 获取视频列表，每次请求返回10个视频
 * @param &#123;number&#125; page 请求的页数
 * @param &#123;number&#125; anchor 保证数据的不重复性
 */
function getCoubVideoList(c, page = 1, anchor, next) &#123;
    if (!c) &#123;
        log.error('category empty', c)
        return next(new Error('category empty'), null)
    &#125;
    var options = &#123;
        method: 'GET',
        url: `https://coub.com/api/v2/timeline/hot/$&#123;c&#125;/$&#123;time&#125;`,
        //url: `https://coub.com/api/v2/timeline/hot/$&#123;c&#125;/half`,
        qs: &#123;
            page: page,
            per_page: per_page
        &#125;
    &#125;;
    if (anchor) options.qs.anchor = anchor

<pre><code>request(options, function (error, response, body) &#123;
    if (error) &#123;
        next(error, null)
        return
    &#125;
    let data = JSON.parse(body)

    if (data &amp;amp;&amp;amp; data.coubs &amp;amp;&amp;amp; data.coubs.length) &#123;
        log.info(`获取视频列表成功 page $&#123;page&#125;`, data.next, data.coubs.length)
        //videoList.push(data.data)
        videoList = videoList.concat(data.coubs)
        return next(null, c, ++data.page, data.next)
    &#125; else &#123;
        log.info(&#39;获取内容为空 page $&#123;page&#125;&#39;)
        return next(null, c, ++data.page, data.next)
    &#125;
&#125;);
</code></pre>
<p>}</p>
<p>/**</p>
<ul>
<li>获取指定分类的总页数</li>
<li>/<br>const getTotalPage = (c) =&gt; {<br>  var options = {<pre><code>  method: &#39;GET&#39;,
  url: `https://coub.com/api/v2/timeline/hot/$&#123;c&#125;/$&#123;time&#125;`,
  //url: `https://coub.com/api/v2/timeline/hot/$&#123;c&#125;/half`,
  qs: &#123;
      page: 1,
      per_page: per_page
  &#125;
</code></pre>
  };<br>  return new Promise((resolve, reject) =&gt; {<pre><code>  request(options, function (error, response, body) &#123;
      if (error) return reject(new Error(error))
      let data = JSON.parse(body)
      if (data &amp;amp;&amp;amp; data.total_pages) &#123;
          log.info(`获取$&#123;c&#125;总页数成功`, data.total_pages)
          return resolve(data.total_pages)
      &#125; else &#123;
          log.info(`获取$&#123;c&#125;总页数失败`)
          return reject(new Error(&#39;页数为空&#39;))
      &#125;
  &#125;);
</code></pre>
  })</li>
</ul>
<p>}</p>
<p>/**</p>
<ul>
<li>获取多页的视频</li>
<li>/<br>const getMultiVideo = async c =&gt; {<br>  // 总页数<br>  let totalPage = await getTotalPage(c)<br>  // 每页依次队列获取<br>  let actions = [async.constant(c, startPage, startAnchor)]<br>  for (let i = 1; i &lt;= totalPage; i++) {<pre><code>  actions.push(getCoubVideoList)
</code></pre>
  }<br>  return new Promise((resolve, reject) =&gt; {<pre><code>  async.waterfall(actions, function (err, result) &#123;
      log.info(`finish crawler $&#123;c&#125; videos`, err, videoList.length)
      if (err) return reject(new Error(err))
      return resolve(videoList)
  &#125;)
</code></pre>
  })<br>}</li>
</ul>
<p>/**</p>
<ul>
<li><p>根据视频的permalink下载视频</p>
</li>
<li><p>@param {string} id video permalink</p>
</li>
<li><p>/<br>async function downloadFile(c, video, next) {<br>  if (!video || !video.permalink) return next(null, ‘’)<br>  let id = video.permalink</p>
<p>  let filename = <code>$&#123;dlPath&#125;/$&#123;id&#125;.mp4</code></p>
<p>  let isExist = isFileExist(id)<br>  // 文件已存在<br>  if (isExist) {</p>
<pre><code>  return next(null, filename)
</code></pre>
<p>  }</p>
<p>  // 下载操作<br>  const coub = await Coub.fetch(<code>http://coub.com/view/$&#123;id&#125;</code>).catch(error =&gt; {</p>
<pre><code>  console.log(&#39;fetch error&#39;, error)
  return next(null, &#39;&#39;)
</code></pre>
<p>  })<br>  if (!coub) return next(null, ‘’)<br>  coub.attachAudio()<br>  if (fastMode) coub.addOption(‘-c’, ‘copy’)<br>  coub.addOption(‘-shortest’)<br>  let ts = new Date()<br>  coub.write(filename)</p>
<pre><code>  .then(result =&amp;gt; &#123;
      let te = new Date()
      let tu = (te - ts) / 1000
      log.info(`$&#123;downloadCount&#125;：finish download $&#123;c&#125; $&#123;id&#125;.mp4`, filename, `用时$&#123;tu&#125;s`)
      downloadCount++
      // 视频信息
      let videoInfo = &#123;
          desc: video.title,
          category: c,
          filename: `$&#123;id&#125;.mp4`
      &#125;
      // 实时写入json
      saveJsonData(videoInfo)

      dlFilesJson.push(videoInfo)
      return next(null, result)
      //return resolve(result)
  &#125;)
  .catch(error =&amp;gt; &#123;
      log.error(`download error $&#123;id&#125;.mp4`, error)
      return next(error, &#39;&#39;)
      //return reject(error)
  &#125;)
</code></pre>
<p>}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li><p>视频是否已下载</p>
</li>
<li><p>/<br>const isFileExist = id =&gt; {<br>  let oldPath = path.resolve(__dirname, <code>./src/video/$&#123;id&#125;.mp4</code>);<br>  let newPath = path.resolve(__dirname, <code>./downloads/video/$&#123;id&#125;.mp4</code>);<br>  let weeklyPath = path.resolve(__dirname, <code>./weekly/video/$&#123;id&#125;.mp4</code>);<br>  let monthlyPath = path.resolve(__dirname, <code>./monthly/video/$&#123;id&#125;.mp4</code>);<br>  let quarterPath = path.resolve(__dirname, <code>./quarter/video/$&#123;id&#125;.mp4</code>);<br>  let halfPath = path.resolve(__dirname, <code>./half/video/$&#123;id&#125;.mp4</code>);</p>
<p>  if (fs.existsSync(oldPath)) {</p>
<pre><code>  log.info(&#39;file exist&#39;, oldPath)
  return true
</code></pre>
<p>  } else if (fs.existsSync(newPath)) {</p>
<pre><code>  log.info(&#39;file exist&#39;, newPath)
  return true
</code></pre>
<p>  } else if(fs.existsSync(weeklyPath)){</p>
<pre><code>  log.info(&#39;file exist&#39;, weeklyPath)
  return true
</code></pre>
<p>  } else if(fs.existsSync(monthlyPath)){</p>
<pre><code>  log.info(&#39;file exist&#39;, monthlyPath)
  return true
</code></pre>
<p>  } else if(fs.existsSync(quarterPath)){</p>
<pre><code>  log.info(&#39;file exist&#39;, quarterPath)
  return true
</code></pre>
<p>  } else if(fs.existsSync(halfPath)){</p>
<pre><code>  log.info(&#39;file exist&#39;, halfPath)
  return true
</code></pre>
<p>  } else return false<br>}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li><p>视频下载成功后，实时更新json数据。防止程序中途奔溃后视频信息未保存</p>
</li>
<li><p>@param {*} data </p>
</li>
<li><p>/<br>const saveJsonData = data =&gt; {<br>  try {</p>
<pre><code>  // 读取已有json信息
  let jsonFile = `$&#123;jsonPath&#125;/all.json`

  let jsonData = []
  if (fs.existsSync(jsonFile)) &#123;
      fileData = fs.readFileSync(jsonFile, &#123;
          encoding: &#39;utf8&#39;
      &#125;)
      if (fileData) &#123;
          jsonData = JSON.parse(fileData)
      &#125;
  &#125;
  // 写入
  jsonData.push(data)
  fs.writeFileSync(jsonFile, JSON.stringify(jsonData));
</code></pre>
<p>  } catch (error) {</p>
<pre><code>  log.error(&#39;写入json文件失败&#39;, data)
</code></pre>
<p>  }</p>
</li>
</ul>
<p>}</p>
<p>/**</p>
<ul>
<li><p>使用-C模式，将视频与音频快速合并，速度快，但问题视频较多，视频声音不正常。</p>
</li>
<li><p>使用非-C模式，速度较慢，且由于合并时占用cpu较大，多个视频合并任务同时进行时，电脑基本会卡死</p>
</li>
<li><p>最终采用非-C模式，保证每个视频的音频正常。同时为保证电脑不死机，以队列模式依次处理。唯一缺陷是耗时。</p>
</li>
<li><p>/<br>async function doDownload(c) {<br>  let result = await getMultiVideo(c)<br>  videoList = []<br>  let data = []<br>  result.forEach(item =&gt; data = data.concat(item))<br>  log.info(<code>要抓取的 $&#123;c&#125; 类型的视频总数为 $&#123;data.length&#125; 个</code>)</p>
<p>  let actions = data.map(video =&gt; next =&gt; {</p>
<pre><code>  downloadFile(c, video, next)
</code></pre>
<p>  })</p>
<p>  return new Promise((resolve, reject) =&gt; {</p>
<pre><code>  let st = new Date()
  async.series(actions, function (err, result) &#123;
      let et = new Date()
      let ut = timeUsed((et - st) / 1000)
      log.info(`finish download $&#123;c&#125; video, 耗时 $&#123;ut&#125;`, err, result.length)

      if (err) return reject(new Error(err))
      // 每个分类的json
      fs.writeFileSync(`$&#123;jsonPath&#125;/$&#123;c&#125;.json`, JSON.stringify(dlFilesJson));
      dlFilesJson = []
      downloadCount = 1
      return resolve(result)
  &#125;)
</code></pre>
<p>  })</p>
</li>
</ul>
<p>}</p>
<p>async function main() {</p>
<pre><code>let animals_pets = await doDownload(&#39;animals-pets&#39;)
let mashup = await doDownload(&#39;mashup&#39;)
let anime = await doDownload(&#39;anime&#39;)
let movies = await doDownload(&#39;movies&#39;)
let gaming = await doDownload(&#39;gaming&#39;)
let cartoons = await doDownload(&#39;cartoons&#39;)
let art = await doDownload(&#39;art&#39;)
let music = await doDownload(&#39;music&#39;)
let news  = await doDownload(&#39;news&#39;)
let sports = await doDownload(&#39;sports&#39;)
let science_technology = await doDownload(&#39;science-technology&#39;)
let celebrity = await doDownload(&#39;celebrity&#39;)
let nature_travel = await doDownload(&#39;nature-travel&#39;)
let fashion = await doDownload(&#39;fashion&#39;)
let dance = await doDownload(&#39;dance&#39;)
let cars = await doDownload(&#39;cars&#39;)
let nsfw = await doDownload(&#39;nsfw&#39;)

return true
</code></pre>
<p>}</p>
<p>/**</p>
<ul>
<li>用时显示</li>
<li>/<br>const timeUsed = t =&gt; {<br>  // [1s, 1m)<br>  if (t &lt; 60) return <code>$&#123;Math.round(t)&#125;s</code><br>  // [1m, 1h)<br>  else if (t &gt;= 60 &amp;&amp; t &lt; 60 * 60) return <code>$&#123;Math.floor(t/60)&#125;m$&#123;Math.floor(t%60)&#125;s</code><br>  // [1h, 1d)<br>  else if (t &gt;= 60 * 60 &amp;&amp; t &lt; 60 * 60 * 24) return <code>$&#123;Math.floor(t/(60*60))&#125;h$&#123;Math.floor(t%(60*60)/60)&#125;m</code><br>  // [1d, ~)<br>  else return <code>$&#123; Math.floor(t/(24*60*60)) &#125;d $&#123; Math.floor( t%(24*60*60)/(60*60) ) &#125;h</code><br>}</li>
</ul>
<p>main()<br>    .then(result =&gt; {<br>        let endTime = new Date()<br>        let usedTime = timeUsed((endTime - startTime) / 1000)<br>        log.info(<code>all downloads finish，$&#123;result&#125; 个视频，共耗时 $&#123;usedTime&#125;</code>, )<br>    })<br>    .catch(error =&gt; {<br>        log.error(‘download error’, error)<br>    })<br>    .then(() =&gt; {<br>        process.exit(0)<br>    })</p>
<p>process.on(‘uncaughtException’, err =&gt; {<br>    log.info(err)<br>    log.info(JSON.stringify(dlFilesJson))<br>})<br></code></pre><!--kg-card-end: code--><p>完整代码： <a target="_blank" rel="noopener" href="https://github.com/flute/coub-crawler">https://github.com/flute/coub-crawler</a></p></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-09-25T11:39:02.000Z" title="9/25/2018, 7:39:02 PM">2018-09-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-01-14T10:05:27.000Z" title="1/14/2019, 6:05:27 PM">2019-01-14</time></span><span class="level-item">8 minutes read (About 1193 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/25/9GAG-com-%E5%86%85%E5%AE%B9%E6%8A%93%E5%8F%96/">9GAG.com 内容抓取</a></h1><div class="content"><h3 id="-">抓取说明</h3><p>1、总共52个分类。</p><p>2、数据获取</p><ul><li>url：<code>https://9gag.com/v1/group-posts/group/cute/type/hot?c=10</code></li><li>说明：<code>cute</code> 为分类。首次获取只需传入 <code>c=10</code> 即为前十条数据。下次请求附带上次请求返回的 <code>nextCursor</code> 参数即可。每次请求返回10条数据。</li></ul><p>3、每个资源的属性：</p><ul><li>唯一标志： id</li><li>资源描述： titile</li></ul><p>4、资源分三种类型，根据images属性下的字段区分</p><ol><li> image  属性：image460    image700  </li><li> gif  属性：image460    image460sv  image460svwm    image700 说明：image460sv image460svwm 两个属性下的 hasAudio 字段为0，及为无声，即为GIF  </li><li> video  属性：image460    image460sv  image460svwm   image700 说明：image460sv image460svwm 两个属性下的 hasAudio 字段为1，及为有声，即为video  </li></ol><p>5、内容字段</p>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">image460: &#123;</span><br><span class="line">  <span class="attr">height</span>: <span class="number">258</span></span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;https://img-9gag-fun.9cache.com/photo/aq73Yrj_460s.jpg&quot;</span></span><br><span class="line">  <span class="attr">webpUrl</span>: <span class="string">&quot;https://img-9gag-fun.9cache.com/photo/aq73Yrj_460swp.webp&quot;</span></span><br><span class="line">  <span class="attr">width</span>: <span class="number">460</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">image460sv</span>: &#123;</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">32</span></span><br><span class="line">  <span class="attr">h265Url</span>: <span class="string">&quot;https://img-9gag-fun.9cache.com/photo/aq73Yrj_460svh265.mp4&quot;</span></span><br><span class="line">  <span class="attr">hasAudio</span>: <span class="number">1</span></span><br><span class="line">  <span class="attr">height</span>: <span class="number">258</span></span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;https://img-9gag-fun.9cache.com/photo/aq73Yrj_460sv.mp4&quot;</span></span><br><span class="line">  <span class="attr">vp9Url</span>: <span class="string">&quot;https://img-9gag-fun.9cache.com/photo/aq73Yrj_460svvp9.webm&quot;</span></span><br><span class="line">  <span class="attr">width</span>: <span class="number">460</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">image460svwm</span>: &#123;</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">32</span></span><br><span class="line">  <span class="attr">hasAudio</span>: <span class="number">1</span></span><br><span class="line">  <span class="attr">height</span>: <span class="number">258</span></span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;https://img-9gag-fun.9cache.com/photo/aq73Yrj_460svwm.webm&quot;</span></span><br><span class="line">  <span class="attr">width</span>: <span class="number">460</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">image700</span>: &#123;</span><br><span class="line">  <span class="attr">height</span>: <span class="number">258</span></span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;https://img-9gag-fun.9cache.com/photo/aq73Yrj_460s.jpg&quot;</span></span><br><span class="line">  <span class="attr">width</span>: <span class="number">460</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、分类数组</p>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&#x27;funny&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;cute&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;anime-manga&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;ask9gag&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;awesome&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;basketball&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;car&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;comic&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;cosplay&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;country&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;classicalartmemes&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;imadedis&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;drawing&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;animefanart&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;food&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;football&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;fortnite&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;gaming&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;gif&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;girl&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;girly&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;guy&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;horror&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;kpop&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;leagueoflegends&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;lego&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;movie-tv&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;music&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;overwatch&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pcmr&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;photography&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pokemon&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;politics&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;relationship&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pubg&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;roastme&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;savage&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;starwars&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;satisfying&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;school&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;science&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;superhero&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;surrealmemes&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;sport&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;travel&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;timely&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;video&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;warhammer&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;wallpaper&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;wtf&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="--1">核心代码：</h3>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> get9gagList = (category, offset, next) = &amp; gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> options = &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`https://9gag.com/v1/group-posts/group/<span class="subst">$&#123;category&#125;</span>/type/<span class="subst">$&#123;type&#125;</span>?`</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (offset == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    options.url += <span class="string">&#x27;c=10&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (offset == -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> next(<span class="string">&#x27;complete&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    options.url += offset</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  request(options, <span class="function"><span class="keyword">function</span> (<span class="params">error, response, body</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      next(error, <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(body)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data &amp; amp; &amp; amp; data.data &amp; amp; &amp; amp; data.data.posts &amp; amp; &amp; amp; data.data.posts.length) &#123;</span><br><span class="line">      log.info(<span class="string">`获取 <span class="subst">$&#123;category&#125;</span> 视频列表成功 offset <span class="subst">$&#123;offset? offset: <span class="string">&#x27;c=10&#x27;</span>&#125;</span>`</span>, data.data.posts.length)</span><br><span class="line">      <span class="comment">//videoList.push(data.data)</span></span><br><span class="line">      videoList = videoList.concat(data.data.posts)</span><br><span class="line">      <span class="keyword">return</span> next(<span class="literal">null</span>, category, data.data.nextCursor)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      log.info(<span class="string">`获取 <span class="subst">$&#123;category&#125;</span> 内容为空 offset <span class="subst">$&#123;offset&#125;</span>，所有数据获取完毕 。`</span>)</span><br><span class="line">      <span class="keyword">return</span> next(<span class="literal">null</span>, category, -<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量获取内容列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getMultiList = <span class="keyword">async</span> category = &amp; gt; &#123;</span><br><span class="line">  <span class="comment">// 每页依次队列获取</span></span><br><span class="line">  <span class="keyword">let</span> actions = [<span class="keyword">async</span>.constant(category, <span class="string">&#x27;&#x27;</span>)]</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &amp; lt; = pageCount; i++) &#123;</span><br><span class="line">    actions.push(get9gagList)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) = &amp; gt; &#123;</span><br><span class="line">    <span class="keyword">async</span>.waterfall(actions, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">      log.info(<span class="string">`finish crawler <span class="subst">$&#123;category&#125;</span> videos`</span>, err, videoList.length)</span><br><span class="line">      <span class="comment">//if (err) return reject(new Error(err))</span></span><br><span class="line">      <span class="keyword">if</span> (err) log.info(err)</span><br><span class="line">      <span class="keyword">return</span> resolve(videoList)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载视频/图片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> download = (category, media, next) = &amp; gt; &#123;</span><br><span class="line">  <span class="comment">//return new Promise((resolve, reject) =&amp;gt; &#123;</span></span><br><span class="line">  <span class="keyword">let</span> isExist = isFileExist(media.id)</span><br><span class="line">  <span class="keyword">if</span> (isExist) <span class="keyword">return</span> next(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> filePath</span><br><span class="line">  <span class="keyword">if</span> (media.type == <span class="string">&#x27;video&#x27;</span>) &#123;</span><br><span class="line">    filePath = <span class="string">`<span class="subst">$&#123;videoDlPath&#125;</span>/<span class="subst">$&#123;media.id&#125;</span>.mp4`</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (media.type == <span class="string">&#x27;img&#x27;</span>) &#123;</span><br><span class="line">    filePath = <span class="string">`<span class="subst">$&#123;imgDlPath&#125;</span>/<span class="subst">$&#123;media.id&#125;</span>.jpg`</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">return</span> next(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  request(media.url)</span><br><span class="line">    .on(<span class="string">&#x27;response&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// create file write stream</span></span><br><span class="line">      <span class="keyword">var</span> fws = fs.createWriteStream(filePath);</span><br><span class="line">      <span class="comment">// setup piping</span></span><br><span class="line">      res.pipe(fws);</span><br><span class="line">      <span class="comment">// finish</span></span><br><span class="line">      res.on(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        log.info(<span class="string">`finish download <span class="subst">$&#123;category&#125;</span> <span class="subst">$&#123;filePath&#125;</span>`</span>)</span><br><span class="line">        saveJsonData(media.type, &#123;</span><br><span class="line">          <span class="attr">id</span>: media.id,</span><br><span class="line">          <span class="attr">category</span>: category,</span><br><span class="line">          <span class="attr">desc</span>: media.desc</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (media.type == <span class="string">&#x27;video&#x27;</span>) videoAmount++</span><br><span class="line">        <span class="keyword">else</span> imgAmount++</span><br><span class="line"></span><br><span class="line">        <span class="comment">//return resolve(filePath)</span></span><br><span class="line">        <span class="keyword">return</span> next(<span class="literal">null</span>)</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// error handler</span></span><br><span class="line">      res.on(<span class="string">&#x27;error&#x27;</span>, err = &amp; gt; &#123;</span><br><span class="line">        log.error(<span class="string">&#x27;download error&#x27;</span>, err)</span><br><span class="line">        <span class="comment">//return reject(err)</span></span><br><span class="line">        <span class="keyword">return</span> next(<span class="literal">null</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="comment">//&#125;)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频是否已下载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> isFileExist = id = &amp; gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> videoPath = <span class="string">`<span class="subst">$&#123;videoDlPath&#125;</span>/<span class="subst">$&#123;id&#125;</span>.mp4`</span></span><br><span class="line">  <span class="keyword">let</span> imgPath = <span class="string">`<span class="subst">$&#123;imgDlPath&#125;</span>/<span class="subst">$&#123;id&#125;</span>.jpg`</span></span><br><span class="line">  <span class="keyword">if</span> (fs.existsSync(videoPath)) &#123;</span><br><span class="line">    log.info(<span class="string">&#x27;video file exist&#x27;</span>, videoPath)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fs.existsSync(imgPath)) &#123;</span><br><span class="line">    log.info(<span class="string">&#x27;img file exist&#x27;</span>, imgPath)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频下载成功后，实时更新json数据。防止程序中途奔溃后视频信息未保存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> saveJsonData = (type, data) = &amp; gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 读取已有json信息</span></span><br><span class="line">    <span class="keyword">let</span> jsonFile = type == <span class="string">&#x27;video&#x27;</span> ? videoJsonPath : imgJsonPath</span><br><span class="line">    jsonFile += <span class="string">`/data.json`</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> jsonData = []</span><br><span class="line">    <span class="keyword">if</span> (fs.existsSync(jsonFile)) &#123;</span><br><span class="line">      fileData = fs.readFileSync(jsonFile, &#123;</span><br><span class="line">        <span class="attr">encoding</span>: <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> (fileData) &#123;</span><br><span class="line">        jsonData = <span class="built_in">JSON</span>.parse(fileData)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 写入</span></span><br><span class="line">    jsonData.push(data)</span><br><span class="line">    fs.writeFileSync(jsonFile, <span class="built_in">JSON</span>.stringify(jsonData));</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    log.error(<span class="string">&#x27;写入json文件失败&#x27;</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将无声MP4转为gif图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> convertVideoToGift = () = &amp; gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> videoPath = <span class="string">&#x27;./233.mp4&#x27;</span></span><br><span class="line">  <span class="keyword">var</span> command = ffmpeg(videoPath)</span><br><span class="line">    .format(<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">  command.save(<span class="string">&#x27;./233.gif&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 内容筛选，只下载有声视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> mediaFilter = data = &amp; gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> results = [],</span><br><span class="line">    videos = [],</span><br><span class="line">    imgs = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &amp; lt; data.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> video = data[i]</span><br><span class="line">    <span class="keyword">if</span> (video.images.image460sv &amp; amp; &amp; amp; video.images.image460sv.hasAudio &amp; amp; &amp; amp; video.images.image460sv.url) &#123;</span><br><span class="line">      <span class="comment">// 有声视频</span></span><br><span class="line">      videos.push(&#123;</span><br><span class="line">        <span class="attr">id</span>: video.id,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;video&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: video.images.image460sv.url,</span><br><span class="line">        <span class="attr">desc</span>: video.title</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!video.images.image460sv &amp; amp; &amp; amp; video.images.image460.url) &#123;</span><br><span class="line">      <span class="comment">// 图片</span></span><br><span class="line">      imgs.push(&#123;</span><br><span class="line">        <span class="attr">id</span>: video.id,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;img&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: video.images.image460.url,</span><br><span class="line">        <span class="attr">desc</span>: video.title</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">results</span>: results.concat(videos, imgs),</span><br><span class="line">    <span class="attr">video</span>: videos.length,</span><br><span class="line">    <span class="attr">img</span>: imgs.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 每个分类的抓取任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> task = <span class="keyword">async</span> (category, next) = &amp; gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> videoLists = <span class="keyword">await</span> getMultiList(category)</span><br><span class="line">  videoList = []</span><br><span class="line">  log.info(<span class="string">&#x27;数据获取成功&#x27;</span>, videoLists.length)</span><br><span class="line">  <span class="keyword">let</span> &#123;</span><br><span class="line">    <span class="attr">results</span>: videos,</span><br><span class="line">    video,</span><br><span class="line">    img</span><br><span class="line">  &#125; = mediaFilter(videoLists)</span><br><span class="line">  log.info(<span class="string">`<span class="subst">$&#123;videoLists.length&#125;</span> 个内容，有声视频共 <span class="subst">$&#123;video&#125;</span> 个，图片共 <span class="subst">$&#123;img&#125;</span> 个`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> dlActions = videos.map(video = &amp; gt; next = &amp; gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> download(category, video, next)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span>.series(dlActions, (err, result) = &amp; gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      log.error(<span class="string">`finish【<span class="subst">$&#123;category&#125;</span>】all download error`</span>, error)</span><br><span class="line">      <span class="keyword">return</span> next(error)</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">`finish【<span class="subst">$&#123;category&#125;</span>】all downloads success`</span>, result.filter(item = &amp; gt; item).length)</span><br><span class="line">    <span class="keyword">return</span> next(<span class="literal">null</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> main = () = &amp; gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> actions = category.map(item = &amp; gt; next = &amp; gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> task(item, next)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) = &amp; gt; &#123;</span><br><span class="line">    <span class="keyword">async</span>.series(actions, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(err))</span><br><span class="line">      <span class="keyword">return</span> resolve(result)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line">  .then(result = &amp; gt; &#123;</span><br><span class="line">    log.info(<span class="string">`awsome！ all <span class="subst">$&#123;result.length&#125;</span> tasks finish success! video: <span class="subst">$&#123;videoAmount&#125;</span> 个, img: <span class="subst">$&#123;imgAmount&#125;</span> 个`</span>, )</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error = &amp; gt; &#123;</span><br><span class="line">    log.info(<span class="string">`all tasks finish error!  video: <span class="subst">$&#123;videoAmount&#125;</span>, img: <span class="subst">$&#123;imgAmount&#125;</span>`</span>, error)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(() = &amp; gt; &#123;</span><br><span class="line">    process.exit(<span class="number">0</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>完整代码： <a target="_blank" rel="noopener" href="https://github.com/flute/9gag-crawler">https://github.com/flute/9gag-crawler</a></p></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-09-11T12:33:38.000Z" title="9/11/2018, 8:33:38 PM">2018-09-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-01-14T10:05:51.000Z" title="1/14/2019, 6:05:51 PM">2019-01-14</time></span><span class="level-item">6 minutes read (About 965 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/11/%E5%B9%B2%E9%94%85%E5%9C%9F%E8%B1%86%E7%89%87-%E5%B0%96%E6%A4%92%E8%82%89%E4%B8%9D/">干锅土豆片+尖椒肉丝</a></h1><div class="content"><p>虽然国家一直在推行简化各种手续的办理流程，但是距离像网上购物一样便捷的愿望，真的是还差两个西天取经的路程🙄。不吐槽了，开始主题。</p>
<p>忙里偷闲的一天，办完手续中午在家自己整点吃的。冰箱打开只有土豆、洋葱、辣椒、肉丝。那就整两个菜吧，如题。其实应该叫家常土豆片？不过放在干锅里就叫干锅土豆片了…。别问我为什么这么喜欢土豆，因为我种过将近十年土豆😂。非常简单实用的两个小菜。</p>
<h3 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h3><ul>
<li>土豆</li>
<li>洋葱</li>
<li>辣椒</li>
<li>葱、姜、蒜、干辣椒</li>
<li>火锅底料</li>
<li>生抽、老抽、盐、胡椒粉、鸡精</li>
</ul>
<h3 id="开搞"><a href="#开搞" class="headerlink" title="开搞"></a>开搞</h3><p>一、干锅土豆片</p>
<p>1、准备食材：<br>食材准备，土豆切片洗净，洋葱切片，辣椒切成丝或者快都行。葱姜蒜切好，少许火锅底料/豆瓣酱。</p>
<p>2、炒土豆：</p>
<ol>
<li>开火热锅，锅热后倒少许油。</li>
<li>稍许油热后倒入少许火锅底料、干辣椒、葱姜蒜，煸香后倒入土豆翻炒，中途可加入少许食盐、胡椒粉。</li>
<li>大约翻炒大约2分钟左右，土豆片已经半熟。倒入洋葱继续翻炒，加入老抽上色。油干的时候边炒边加入少许清水，分批次少量加。这样小炒3分钟左右土豆基本熟了。</li>
<li>加入辣椒，倒入酱油提味，再翻炒一分钟，然后加入味精提味，加入少许盐。喜欢酸味的可以加入少许醋。就可以出锅了。</li>
</ol>
<p>就是这么简单。</p>
<p>二、尖椒肉丝</p>
<p>1、准备食材：<br>整块猪肉的需要自己切成肉丝，从冰箱拿出来稍微解冻一点后更好切。或者直接买肉时让人家机器切成肉丝最省事。尖椒切成条状，与肉丝类似。肉用水冲洗后，可以用加料酒、胡椒粉、盐稍微腌一会会更有味。葱姜蒜必备。</p>
<p>2、开炒</p>
<ol>
<li>类似的，热锅到油，热油倒入葱姜蒜。</li>
<li>然后倒入肉丝翻炒，炒至肉丝变色即可，中途加入少许盐、胡椒粉等，倒入老抽上色。</li>
<li>然后倒入尖椒翻炒，生抽提味，翻炒1~2分钟即可，然后味精提味出锅即可。</li>
</ol>
<p>注意肉丝不能炒的时间长，肉容易变干变老。</p>
<p>两个菜都比较简单，基本上20分钟两个菜就搞定。一个人的话蒸米饭可以用煮蛋器蒸一碗，刚好够。</p>
<p>最后上图</p>
<p>有的步骤忘拍了，自行脑补。</p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/images/1.JPG?imageMogr2/thumbnail/!50p/blur/1x0/quality/75%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim"></p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/images/2.JPG?imageMogr2/thumbnail/!50p/blur/1x0/quality/75%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim"></p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/images/3.JPG?imageMogr2/thumbnail/!50p/blur/1x0/quality/75%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim"></p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/images/4.JPG?imageMogr2/thumbnail/!50p/blur/1x0/quality/75%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim"></p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/images/5.JPG?imageMogr2/thumbnail/!50p/blur/1x0/quality/75%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim"></p>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ghost/images/6.JPG?imageMogr2/thumbnail/!50p/blur/1x0/quality/75%7Cwatermark/1/image/aHR0cHM6Ly9vYzhwcnRlcXUucW5zc2wuY29tL2ltYWdlcy93YXRlcm1hcmsucG5n/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-09-06T07:04:10.000Z" title="9/6/2018, 3:04:10 PM">2018-09-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2018-09-06T12:53:10.000Z" title="9/6/2018, 8:53:10 PM">2018-09-06</time></span><span class="level-item">26 minutes read (About 3870 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/06/NEM%EF%BC%88%E6%96%B0%E7%BB%8F%E5%B8%81%EF%BC%89%E5%85%AC%E9%93%BE%E5%AF%B9%E6%8E%A5/">NEM（新经币）公链对接</a></h1><div class="content"><p>首先祝Chrome十周年生快，升级后的69耳目一新，继续加油。</p><h3 id="-">前言</h3><p>通常，当某个交易所要上新币的时候，都会提前下发通知。如果仔细点就会发现，如果是ERC20 Token的话，交易所基本是“秒上”，而对于其他非以太坊公链的Token，交易所一般会提前半月至一月发上币通知。原因很简单，对于ERC20 Token，由于都是运行在以太坊公链上，所以有着共通的运行机制，对于不同的Token，通过调用geth节点的API只需传入不同的合约地址，就能执行不同Token的转账、查余额等等一系列合约方法。也就是说代码可以完全复用，交易所上币只是添加了一个新币的合约地址，就能和其他ERC20 Token共用一套代码。</p><p>而对于非以太坊公链的Token，它们运行在其他完全不同的公链上。由于公链之间的开发语言、账户设计、Token设计、Token转账流程、共识机制等等都存在着天差地别，所以对这些公链上的Token进行操作，流程是不同于ERC20 Token的，也就是说代码不能与以太坊的复用。需要重新写一套适配该公链的程序，来完成对该公链上Token的发行、转账、查询等一些列操作。这就是为什么交易所在上非ERC20 Token时耗时较长的原因。</p><p>本文记录对于NEM（新经币）的对接过程。</p><h3 id="--1">新经币介绍</h3><p>维基百科介绍：</p><blockquote>新经币（New Economy Movement，缩写 NEM），是一种点对点虚拟货币。2015年初发布，其源代码由Java编写并100%属于原创。[1]NEM 广泛发布于人群中[2]，其块链采用了全新发明的基于重要性证明POI的同步解决方案。NEM特征也包括：完整的点对点安全系统加密信息系统和基于Eigentrust++算法的声望系统。[3]</blockquote><p>新经币NEM使用Java开发，且使用独创的POI（重要性证明机制），并且融合多重签名技术。单从这三点来看，NEM在技术和创新上，在各公链中属于上等马。</p><p>NEM新经币的原生Token为XEM。市值在60~100亿之间浮动，排名在10~20名之间。</p><p>新经币允许用户在其链上发型资产“mosaic”（翻译过来就是马赛克🌚），对标以太坊上发行的ERC20 Token。区别在于，发行的mosaic并不是以合约形式进行的，所以功能非常简单，不能像以太坊智能合约一样实现多样化的功能。它只具备Token的基础属性，即名称、发行量、精度。以及一些附加属性如发行量是否可修改、是否可转账、描述等。</p><p>mosaic代币在链上的唯一标识为<code>mosaic id</code>，对标以太坊合约的合约地址。<code>mosaic id</code>由两部分组成：<code>namespace + mosaic name</code>。所以在创建一个新的<code>mosaic</code>前，需要先创建一个<code>namespace</code>，然后在该<code>namespace</code>下创建<code>mosaic name</code>。以pundix这个Token来说，它在NEM链上发行的mosaic的id为 <code>pundix:npxs</code> , 其中 <code>pundix</code>是它的namespace，<code>npxs</code>是其mosaic name。创建一个namespace需要花费100XEM，且全网唯一，不可重复。创建完namespace后，就可以在该namespace下创建mosaic，创建一个mosaic花费10XEM。所以在NEM链上发行一个mosaic代币共需要110XEM+交易手续费（约0.3XEM）。且namespace不得与已存在的重复，该namespace下创建的mosaic的名称也不得出现重复。</p><p>NEM的账户地址分为测试网可主网。测试网地址以T开头，主网地址以N开头。（创建的时候可以挑NB开头的地址👍🏿）</p><h3 id="--2">开发文档</h3><p>官网： <a target="_blank" rel="noopener" href="https://nem.io">https://nem.io</a><br>GitHub： <a target="_blank" rel="noopener" href="https://github.com/NemProject">https://github.com/NemProject</a><br>文档： <a target="_blank" rel="noopener" href="http://docs.nem.io/en">http://docs.nem.io/en</a><br>NIS节点API文档： <a target="_blank" rel="noopener" href="https://nemproject.github.io/">https://nemproject.github.io/</a></p><p>NEM官方提供的API SDK比较全面，相当良心：</p><ul><li>Python    <a target="_blank" rel="noopener" href="https://github.com/semolex/nis-python-client">https://github.com/semolex/nis-python-client</a>  </li><li>Java    <a target="_blank" rel="noopener" href="https://github.com/NEMPH/nem-apps-lib">https://github.com/NEMPH/nem-apps-lib</a>         <a target="_blank" rel="noopener" href="https://github.com/rosklyar/nem-library">https://github.com/rosklyar/nem-library</a>      </li><li>C#    <a target="_blank" rel="noopener" href="https://github.com/NemProject/csharp2nem">https://github.com/NemProject/csharp2nem</a>  </li><li>Typescript/Javascript    <a target="_blank" rel="noopener" href="http://nemlibrary.com">http://nemlibrary.com</a>  </li><li>Javascript    <a target="_blank" rel="noopener" href="https://github.com/QuantumMechanics/NEM-sdk">https://github.com/QuantumMechanics/NEM-sdk</a> <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/nem-api">https://www.npmjs.com/package/nem-api</a>  </li><li>NodeJS  <a target="_blank" rel="noopener" href="https://github.com/NemProject/nodejs2nem">https://github.com/NemProject/nodejs2nem</a>  </li><li>Ruby  <a target="_blank" rel="noopener" href="https://github.com/44uk/nis-ruby">https://github.com/44uk/nis-ruby</a>  </li><li>PHP  <a target="_blank" rel="noopener" href="https://github.com/namuyan/NEM-Api-Library">https://github.com/namuyan/NEM-Api-Library</a> <a target="_blank" rel="noopener" href="https://github.com/tomotomo9696/NEMTools_PHP">https://github.com/tomotomo9696/NEMTools_PHP</a> <a target="_blank" rel="noopener" href="https://github.com/evias/nem-php">https://github.com/evias/nem-php</a>  </li><li>Go  <a target="_blank" rel="noopener" href="https://github.com/nem-toolchain/nem-toolchain">https://github.com/nem-toolchain/nem-toolchain</a>  </li></ul><h3 id="nem-">NEM节点部署</h3><p>如果想在本地启动节点并加入到NEM网络当中，过程非常简单。</p><p>在<code>http://bob.nem.ninja/</code>下载<code>nis</code>最新包之后，解压。nis目录下的<code>config.properties</code>是一些节点信息配置。可以根据需要修改。然后直接运行<code>nix.runNis.sh</code>即可启动节点。</p><!--kg-card-begin: code--><pre><code> ✘ ludis@Mac  ~/Downloads/package  ./nix.runNis.sh
2018-09-06 06:26:38.598 信息 NEM logging has been bootstrapped! (org.nem.deploy.g a)
2018-09-06 06:26:38.617 信息 Acquiring exclusive lock to lock file: /Users/ludis/nem/nis.lock (org.nem.deploy.CommonStarter tryAcquireLock)
2018-09-06 06:26:38.623 警告 no certificate found for (file:/Users/ludis/Downloads/package/nis/nem-deploy-0.6.95-BETA.jar &lt;no signer certificates&gt;) (org.nem.core.metadata.CodeSourceFacade &lt;init&gt;)
2018-09-06 06:26:38.626 信息 Analyzing meta data in &lt;nem-deploy-0.6.95-BETA.jar&gt; (org.nem.core.metadata.JarFacade &lt;init&gt;)
2018-09-06 06:26:38.636 信息 Meta data title &lt;NEM Deploy&gt;, version &lt;0.6.95-BETA&gt; (org.nem.core.metadata.JarFacade &lt;init&gt;)
2018-09-06 06:26:38.639 信息 Starting embedded Jetty Server. (org.nem.deploy.CommonStarter main)
2018-09-06 06:26:39.148 信息 Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@56ef9176: startup date [Thu Sep 06 14:26:39 CST 2018]; root of context hierarchy (org.springframework.context.annotation.AnnotationConfigApplicationContext prepareRefresh)
2018-09-06 06:26:40.751 信息 Loaded JDBC driver: org.h2.Driver (org.springframework.jdbc.datasource.DriverManagerDataSource setDriverClassName)
2018-09-06 06:26:41.394 信息 Database: jdbc:h2:/Users/ludis/nem/nis/data/nis5_mainnet (H2 1.3) (org.flywaydb.core.internal.dbsupport.DbSupportFactory info)
2018-09-06 06:26:41.553 信息 Current version of schema "PUBLIC": 1.0.7 (org.flywaydb.core.internal.command.DbMigrate info)
2018-09-06 06:26:41.555 信息 Schema "PUBLIC" is up to date. No migration necessary. (org.flywaydb.core.internal.command.DbMigrate info)
2018-09-06 06:26:41.834 INFO HCANN000001: Hibernate Commons Annotations &#123;4.0.4.Final&#125; (org.hibernate.annotations.common.reflection.java.JavaReflectionManager &lt;clinit&gt;)
2018-09-06 06:26:41.848 INFO HHH000412: Hibernate Core &#123;4.3.0.Final&#125; (org.hibernate.Version logVersion)
2018-09-06 06:26:41.853 INFO HHH000206: hibernate.properties not found (org.hibernate.cfg.Environment &lt;clinit&gt;)
2018-09-06 06:26:41.860 INFO HHH000021: Bytecode provider name : javassist (org.hibernate.cfg.Environment buildBytecodeProvider)
2018-09-06 06:26:42.398 INFO HHH000400: Using dialect: org.hibernate.dialect.H2Dialect (org.hibernate.dialect.Dialect &lt;init&gt;)
2018-09-06 06:26:42.782 INFO HHH000399: Using default transaction strategy (direct JDBC transactions) (org.hibernate.engine.transaction.internal.TransactionFactoryInitiator initiateService)
2018-09-06 06:26:42.791 INFO HHH000397: Using ASTQueryTranslatorFactory (org.hibernate.hql.internal.ast.ASTQueryTranslatorFactory &lt;init&gt;)
2018-09-06 06:26:42.898 INFO HV000001: Hibernate Validator 5.0.2.Final (org.hibernate.validator.internal.util.Version &lt;clinit&gt;)
2018-09-06 06:26:45.175 信息 Using DataSource [org.springframework.jdbc.datasource.DriverManagerDataSource@5792c08c] of Hibernate SessionFactory for HibernateTransactionManager (org.springframework.orm.hibernate4.HibernateTransactionManager afterPropertiesSet)
2018-09-06 06:26:45.239 警告 context ================== current: 108627620 (org.nem.nis.NisMain init)

<p>……</p>
<p>……</p>
<p>2018-09-06 14:26:51.640:INFO:oejsh.ContextHandler:main: Started o.e.j.s.ServletContextHandler@38c460e8&#123;/,null,AVAILABLE&#125;<br>2018-09-06 14:26:51.640:INFO:oejs.ServerConnector:main: Started ServerConnector@7a814310&#123;HTTP/1.1&#125;&#123;0.0.0.0:7890&#125;<br>2018-09-06 14:26:51.644:INFO:oejs.Server:main: Started @14689ms<br>2018-09-06 06:26:51.644 信息 NEM Deploy is ready to serve. URL is “<a target="_blank" rel="noopener" href="http://192.168.128.10:7890/&quot;">http://192.168.128.10:7890/&quot;</a>. (org.nem.deploy.CommonStarter a)<br>2018-09-06 06:26:51.651 信息 loadBlocks (from height 2802 to height 2901) needed 40ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:51.717 信息 loadBlocks (from height 2902 to height 3001) needed 28ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:51.762 信息 loadBlocks (from height 3002 to height 3101) needed 27ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:51.811 信息 loadBlocks (from height 3102 to height 3201) needed 25ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:51.855 信息 loadBlocks (from height 3202 to height 3301) needed 25ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:51.911 信息 loadBlocks (from height 3302 to height 3401) needed 28ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:51.958 信息 loadBlocks (from height 3402 to height 3501) needed 30ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:52.004 信息 loadBlocks (from height 3502 to height 3601) needed 27ms (org.nem.nis.dao.BlockDaoImpl d)<br>2018-09-06 06:26:52.063 信息 loadBlocks (from height 3602 to height 3701) needed 24ms (org.nem.nis.dao.BlockDaoImpl d)<br>……<br></code></pre><!--kg-card-end: code--><p>这样本地的NIS节点就启动且连接到NEM网络了。可以对照文档进行各种功能测试。</p><h3 id="--3">区块链浏览器</h3><p>主网<br><a target="_blank" rel="noopener" href="http://explorer.nemchina.com">http://explorer.nemchina.com</a><br><a target="_blank" rel="noopener" href="http://chain.nem.ninja">http://chain.nem.ninja</a></p><p>测试网<br><a target="_blank" rel="noopener" href="http://bob.nem.ninja:8765">http://bob.nem.ninja:8765</a></p><h3 id="nem-faucet">nem faucet</h3><p>测试时一些Token是必须的，但nem水龙头是真的不好找啊，能搜到的一些基本都停用了。。且用且珍惜。</p><p><a target="_blank" rel="noopener" href="https://xarleecm.com/en/nemfaucet">https://xarleecm.com/en/nemfaucet</a></p><p>提示：使用这个水龙头申请Token时，需要先用该页面的插件挖矿几分钟后，才可以申请🤔，有点意思哈。没有免费的午餐么，大夏天的，我这air风扇转的那叫一个欢乐。风扇转完点提交，一般几个小时内就会把Token发到你的账户，可以去浏览器查询。</p><p>每小时最多申请100XEM，我申请了10个却意外地得到了500个，果然是个看脸的时代😏。因为创建mosaic需要110+的NEM，所以最好申请多点。</p><h3 id="--4">转账</h3><p>这里使用node sdk，直接将XEM及mosaic转账及余额查询封装起来。需要的可以直接拿去用，转账的具体流程也写的比较清楚，可以参考注释和文档理解。</p><!--kg-card-begin: code--><pre><code>/**</p>
<ul>
<li>nem及mosaic发送交易封装</li>
<li>/</li>
</ul>
<p>const nem = require(“nem-sdk”).default;<br>const config = require(‘./nem_config’)<br>const logger = require(‘./logger’);</p>
<p>/**</p>
<ul>
<li>创建 endpoint 对象（节点信息）</li>
<li>host    string    An NIS uri</li>
<li>port    string    An NIS port</li>
<li>/<br>const endpoint = nem.model.objects.create(“endpoint”)(config.endpointHost, config.endpointPort)<br>logger.info(‘endpoint’, endpoint)</li>
</ul>
<p>/**</p>
<ul>
<li>创建 common 对象 （账户信息）</li>
<li>password    string    A password</li>
<li>privateKey    string    A private key</li>
<li>/<br>const common = nem.model.objects.create(“common”)(config.password, config.privatekey)<br>// console.log(‘common’, common)</li>
</ul>
<p>init()</p>
<p>/**</p>
<ul>
<li><p>nem及mosaic转账入口</p>
</li>
<li><p>/<br>const doNemTransaction = (req, callback) =&gt; &#123;</p>
<p>  let &#123;</p>
<pre><code>  name,
  address: recipient,
  value: amount
</code></pre>
<p>  } = req.body</p>
<p>  let option = {</p>
<pre><code>  name: name,
  recipient: recipient,
  amount: amount
</code></pre>
<p>  }<br>  logger.info(‘option’, option)</p>
<p>  // mosaic Token转账时，transferTransaction amount代表：要执行后续定义的mosaicAttachment的次数！！！<br>  // 而非代表nem的金额，此处与eth Token转账完全不同。为0时转账会成功，但mosaic不会到账~~<br>  if (name == ‘NEM’) {</p>
<pre><code>  amount /= Math.pow(10, 6)
  option.amount = amount
</code></pre>
<p>  } else {</p>
<pre><code>  amount = 1
</code></pre>
<p>  }</p>
<p>  /**</p>
<ul>
<li>创建 transferTransaction 对象（交易信息）</li>
<li>recipient    string    A recipient address</li>
<li>amount    number    An amount</li>
<li>message    string    A message to join</li>
<li>/<br>option.transferTransaction = nem.model.objects.create(“transferTransaction”)(recipient, amount, config.message);<br>logger.info(‘transferTransaction:’, option.transferTransaction)</li>
</ul>
<p>  if (name == ‘NEM’) transferNem(option, callback)<br>  else transferMosaic(option, callback)<br>}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li><p>转账nem</p>
</li>
<li><p>/<br>const transferNem = (option, callback) =&gt; {<br>  /**</p>
<ul>
<li>签名/打包交易信息</li>
<li>common    object    A common object</li>
<li>tx    object    A transferTransaction object</li>
<li>network    number    A network id</li>
<li>/<br>const transactionEntity = nem.model.transactions.prepare(“transferTransaction”)(common, option.transferTransaction, config.networkId)<br>logger.info(‘transactionEntity:’, transactionEntity)</li>
</ul>
<p>  /**</p>
<ul>
<li>计算nem交易手续费</li>
<li>0.05 XEM per 10,000 XEM transferred, capped at 1.25 XEM</li>
<li>Example: 0.20 XEM fee for a 45,000 XEM transfer, 1.25 XEM fee for a 500,000 XEM transfer.</li>
<li>/<br>if (option.amount &gt; 500000) return callback(new Error(‘转账nem不得超过500000’), null)<br>let nemFee = Math.floor(option.amount / 10000) * 0.05<br>nemFee = nemFee &lt; 0.05 ? 0.05 : nemFee<br>nemFee = nemFee &gt; 1.25 ? 1.25 : nemFee</li>
</ul>
<p>  /**</p>
<ul>
<li>计算message fee</li>
<li>message fee. 0.05 XEM per commenced 32 bytes</li>
<li>If the message is empty, the fee will be 0</li>
<li>@param {object} message - An message object</li>
<li>@param {boolean} isHW - True if hardware wallet, false otherwise</li>
<li>@return {number} - The message fee</li>
<li>/<br>let messageFee = nem.model.fees.calculateMessage(transactionEntity.message, false)</li>
</ul>
<p>  let totalFee = nemFee + messageFee<br>  totalFee = totalFee * Math.pow(10, 6)<br>  logger.info(‘nemFee:’, nemFee, ‘messageFee’, messageFee, ‘totalFee’, totalFee)<br>  transactionEntity.fee = totalFee</p>
<p>  /**</p>
<ul>
<li>发送交易（广播交易）</li>
<li>common    object    A common object</li>
<li>entity    object    A prepared transaction object</li>
<li>endpoint    object    An endpoint object</li>
<li>/</li>
</ul>
<p>  // Serialize transfer transaction and announce<br>  nem.model.transactions.send(common, transactionEntity, endpoint)</p>
<pre><code>  .then(function (res) &#123;
      logger.info(&quot;交易详情：&quot;, res)
      //callback(null, res)
      if (res &amp;amp;&amp;amp; res.message == &#39;SUCCESS&#39;) callback(null, res)
      else callback(new Error(res.message), null)
  &#125;)
  .catch(error =&amp;gt; &#123;
      logger.error(&#39;交易失败：&#39;, error)
      callback(error, null)
  &#125;);
</code></pre>
<p>}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li><p>转账mosaic Token</p>
</li>
<li><p>/<br>const transferMosaic = async (option, callback) =&gt; {</p>
<p>  const mosaicData = config.mosaicDefinitions[option.name]<br>  if (!mosaicData) return callback(new Error(‘不支持该币种’), null)<br>  const {</p>
<pre><code>  namespaceId,
  name: mosaicName
</code></pre>
<p>  } = mosaicData.mosaic.id<br>  // mosaic需转换单位<br>  let divisibility<br>  mosaicData.mosaic.properties.forEach(item =&gt; {</p>
<pre><code>  if (item.name == &#39;divisibility&#39;) divisibility = item.value
</code></pre>
<p>  })<br>  if (!divisibility) return callback(new Error(‘divisibility not found’), null)<br>  //blockchain.server 发送转账请求时已经将进制转换，不需要进行二次转换<br>  //option.amount *= Math.pow(10, divisibility)</p>
<p>  /**</p>
<ul>
<li>创建 mosaicDefinitionMetaDataPair 对象</li>
<li>Create variable to store our mosaic definitions, needed to calculate fees properly (already contains xem definition)</li>
<li>doc: <a target="_blank" rel="noopener" href="https://nemproject.github.io/#mosaicDefinitionMetaDataPair">https://nemproject.github.io/#mosaicDefinitionMetaDataPair</a></li>
<li>/<br>const mosaicDefinitionMetaDataPair = nem.model.objects.get(“mosaicDefinitionMetaDataPair”);<br>logger.info(‘mosaicDefinitionMetaDataPair’, mosaicDefinitionMetaDataPair)</li>
</ul>
<p>  /**</p>
<ul>
<li>创建 mosaic 对象（mosaic是nem上的Token，类比Erc20 Token）</li>
<li>namespaceId    string    A namespace name</li>
<li>mosaicName    string    A mosaic name</li>
<li>quantity    long number    A quantity in micro-units（根据divisibility转换为micro-units，npxsxem: 1000000 = 1 ）</li>
<li>doc: <a target="_blank" rel="noopener" href="https://nemproject.github.io/#retrieving-mosaic-definitions">https://nemproject.github.io/#retrieving-mosaic-definitions</a></li>
<li>/<br>var mosaicAttachment = nem.model.objects.create(“mosaicAttachment”)(namespaceId, mosaicName, option.amount);<br>logger.info(‘mosaicAttachment’, mosaicAttachment)</li>
</ul>
<p>  // Push attachment into transaction mosaics<br>  option.transferTransaction.mosaics.push(mosaicAttachment);<br>  logger.info(‘transferTransaction’, option.transferTransaction)</p>
</li>
</ul>
<pre><code>// 可通过接口实时获取mosaic属性 nem.com.requests.namespace.mosaicDefinitions(endpoint, mosaicAttachment.mosaicId.namespaceId)
// 当前mosaic较少，事先通过接口获取后写在配置文件
mosaicDefinitionMetaDataPair[mosaicData.fullMosaicName] = &#123;&#125;;
mosaicDefinitionMetaDataPair[mosaicData.fullMosaicName].mosaicDefinition = mosaicData.mosaic;

// nem mosaic 转账bug: supply为空，导致calculateMosaics返回NaN
// https://github.com/QuantumMechanics/NEM-sdk/issues/36
// https://qiita.com/xiaca/items/9fa40061cd4977b13147
let res = await nem.com.requests.mosaic.supply(endpoint, mosaicData.fullMosaicName)
mosaicDefinitionMetaDataPair[mosaicData.fullMosaicName].supply = res.supply;

/**
 * 签名/打包交易信息
 * common    object    A common object
 * tx    object    A transferTransaction object
 * mosaicDefinitionMetaDataPair    object    A mosaicDefinitionMetaDataPair object
 * network    number    A network id
 */
let transactionEntity = nem.model.transactions.prepare(&quot;mosaicTransferTransaction&quot;)(common, option.transferTransaction, mosaicDefinitionMetaDataPair, config.networkId);
logger.info(&#39;transactionEntity&#39;, transactionEntity)

/**
 * 计算mosaic交易手续费
 * https://nemproject.github.io/#transaction-fees
 * @param &#123;number&#125; multiplier - A quantity multiplier
 * @param &#123;object&#125; mosaics - A mosaicDefinitionMetaDataPair object
 * @param &#123;array&#125; attachedMosaics - An array of mosaics to send
 * @return &#123;number&#125; - The fee amount for the mosaics in the transaction
 */
let mosaicsFee = nem.model.fees.calculateMosaics(1000000, mosaicDefinitionMetaDataPair, option.transferTransaction.mosaics)

/**
 * 计算message fee
 * message fee. 0.05 XEM per commenced 32 bytes
 * If the message is empty, the fee will be 0
 * @param &#123;object&#125; message - An message object
 * @param &#123;boolean&#125; isHW - True if hardware wallet, false otherwise
 * @return &#123;number&#125; - The message fee
 */
let messageFee = nem.model.fees.calculateMessage(transactionEntity.message, false)

let totalFee = mosaicsFee + messageFee
totalFee = totalFee * Math.pow(10, 6)
logger.info(&#39;mosaicsFee:&#39;, mosaicsFee, &#39;messageFee&#39;, messageFee, &#39;totalFee&#39;, totalFee)
transactionEntity.fee = totalFee
// transactionEntity.fee = 1000000
logger.info(&#39;transactionEntity&#39;, transactionEntity)

// Serialize transfer transaction and announce
nem.model.transactions.send(common, transactionEntity, endpoint)
    .then(function (res) &#123;
        logger.info(&quot;交易详情：&quot;, res)
        //callback(null, res.transactionHash.data)
        if (res &amp;amp;&amp;amp; res.message == &#39;SUCCESS&#39;) callback(null, res.transactionHash.data)
        else callback(new Error(res.message), null)
    &#125;)
    .catch(error =&amp;gt; &#123;
        logger.error(&#39;交易失败：&#39;, error)
        callback(error, null)
    &#125;);

/*
// 通过接口实时获取mosaic信息，有levy属性的需要根据levy增加nem amount
nem.com.requests.namespace.mosaicDefinitions(endpoint, mosaicAttachment.mosaicId.namespaceId).then(function(res) &#123;

    // Look for the mosaic definition(s) we want in the request response
    var neededDefinition = nem.utils.helpers.searchMosaicDefinitionArray(res.data, [&quot;nem&quot;]);
    console.log(&#39;neededDefinition&#39;, neededDefinition)
    // Get full name of mosaic to use as object key
    var fullMosaicName  = nem.utils.format.mosaicIdToName(mosaicAttachment.mosaicId);

    // Check if the mosaic was found
    if(undefined === neededDefinition[fullMosaicName]) return console.error(&quot;Mosaic not found !&quot;);

    // Set eur mosaic definition into mosaicDefinitionMetaDataPair
    mosaicDefinitionMetaDataPair[fullMosaicName] = &#123;&#125;;
    mosaicDefinitionMetaDataPair[fullMosaicName].mosaicDefinition = neededDefinition[fullMosaicName];

    // Prepare the transfer transaction object
    var transactionEntity = nem.model.transactions.prepare(&quot;mosaicTransferTransaction&quot;)(common, option.transferTransaction, mosaicDefinitionMetaDataPair, config.networkId);
    transactionEntity.fee = 1000000
    // Serialize transfer transaction and announce
    nem.model.transactions.send(common, transactionEntity, endpoint)
    .then(function (res) &#123;
        console.log(&quot;交易详情：&quot;, res)
        callback(null, res)
    &#125;)
    .catch(error =&amp;gt; &#123;
        console.log(&#39;交易失败：&#39;, error)
        callback(error, null)
    &#125;);
&#125;,
function(err) &#123;
    console.error(err);
&#125;);
 */
</code></pre>
<p>}</p>
<p>/**</p>
<ul>
<li>获取账户余额</li>
<li>/<br>const getNemBalance = (req, callback) =&gt; {<br>  let {<pre><code>  coin: name,
  address
</code></pre>
  } = req.query<br>  address = address ? address : config.adminAddress<br>  let namespaceId, mosaicName<br>  let balance = 0<br>  if (name == ‘NEM’) {<pre><code>  namespaceId = &#39;nem&#39;
  mosaicName = &#39;xem&#39;
</code></pre>
  } else {<pre><code>  if (!config.mosaicDefinitions[name]) return callback(new Error(&#39;不支持该mosaic&#39;), null)
  let mosaicData = config.mosaicDefinitions[name].mosaic.id
  namespaceId = mosaicData.namespaceId
  mosaicName = mosaicData.name
</code></pre>
  }<br>  // <a target="_blank" rel="noopener" href="http://192.3.61.243:7890/account/get?address=TCKUVV6PETWYVUBGTWRCLUROJOJVPY4JZXNRSDKT">http://192.3.61.243:7890/account/get?address=TCKUVV6PETWYVUBGTWRCLUROJOJVPY4JZXNRSDKT</a><br>  // <a target="_blank" rel="noopener" href="http://192.3.61.243:7890/account/mosaic/owned?address=TCKUVV6PETWYVUBGTWRCLUROJOJVPY4JZXNRSDKT">http://192.3.61.243:7890/account/mosaic/owned?address=TCKUVV6PETWYVUBGTWRCLUROJOJVPY4JZXNRSDKT</a><br>  nem.com.requests.account.mosaics.owned(endpoint, address).then(result =&gt; {<pre><code>  result.data.forEach(mosaic =&amp;gt; &#123;
      if (mosaic.mosaicId.namespaceId == namespaceId &amp;amp;&amp;amp; mosaic.mosaicId.name == mosaicName) balance = mosaic.quantity
  &#125;)
  logger.info(&#39;get mosaics owned&#39;, JSON.stringify(result))
  callback(null, String(balance))
</code></pre>
  }).catch(error =&gt; {<pre><code>  logger.error(&#39;get balance error&#39;, error)
  callback(error, null)
</code></pre>
  })<br>}</li>
</ul>
<p>module.exports = {<br>    doNemTransaction: doNemTransaction,<br>    getNemBalance: getNemBalance<br>}<br></code></pre><!--kg-card-end: code--><p>进行测试</p><!--kg-card-begin: code--><pre><code><br>const nem = require('./nem')</p>
<p>// test nem transfer<br>const testNemTransfer = () =&gt; &#123;<br>    let req = &#123;&#125;<br>    req.body = &#123;<br>        name: ‘NEM’,<br>        address: ‘TCKUVV6PETWYVUBGTWRCLUROJOJVPY4JZXNRSDKT’,<br>        value: 8729700<br>    &#125;<br>    nem.doNemTransaction(req, (error, res) =&gt; &#123;<br>        console.log(‘doNemTransaction nem’, error, res)<br>    &#125;)<br>&#125;<br>// test mosaic transfer<br>const testMosaicTransfer = () =&gt; &#123;<br>    let req = &#123;&#125;<br>    req.body = &#123;<br>        name: ‘NPXSXEM’,<br>        address: ‘TCKUVV6PETWYVUBGTWRCLUROJOJVPY4JZXNRSDKT’,<br>        value: 548250000<br>    &#125;<br>    nem.doNemTransaction(req, (error, res) =&gt; &#123;<br>        console.log(‘doNemTransaction mosaic’, error, res)<br>    &#125;)<br>&#125;<br>// test get balance<br>const testGetBalance = () =&gt; &#123;<br>    let req = &#123;&#125;<br>    req.query = &#123;<br>        /* coin: ‘NEM’,<br>        address: ‘TCKUVV6PETWYVUBGTWRCLUROJOJVPY4JZXNRSDKT’ */<br>        coin: ‘NPXSXEM’,<br>        address: ‘TDV75PQWM2RYWVDM6JAFSPNXR44U63B3I4HQOR6A’<br>    &#125;<br>    nem.getNemBalance(req, (error, res) =&gt; &#123;<br>        console.log(‘getNemBalance’, error, res)<br>    &#125;)<br>&#125;</p>
<p>testNemTransfer()<br>testMosaicTransfer()<br>testGetBalance()<br></code></pre><!--kg-card-end: code--><h3 id="--5">其它</h3><p>账户多签也是NEM的一个重要功能。直白说就是，一个钱包由多个人共同管理，只有超多一半的人签名同意后才可以转账，多签可以将多个账户分散存储，加强资产的安全性。多签的实现和转账流程与上述的略有差别，感兴趣的可以自行研究。</p><p>NEM的对开发者来说算是比较友好，完善的文档（细节可以更加完善），多语言的SDK。缺点就是基础设施有点差，比如移动端的钱包，比较鸡肋。而且中文社区较少，中文的开发资料非常少。</p></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">Previous</a></div><div class="pagination-next"><a href="/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/18/">18</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://img.ikstatic.cn/MTYzMTE3MTU3NDM3MCM1MzYjcG5n.png" alt="Ludis"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Ludis</p><p class="is-size-6 is-block">Valar Morghulis, Valar Dohaeris</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">177</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">17</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/flute" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/flute"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/3852099619"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:552452006@qq.com"><i class="far fa-envelope"></i></a></div></div></div><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-30T07:42:16.000Z">2021-06-30</time></p><p class="title"><a href="/2021/06/30/React-Antd-Warning%E7%A7%BB%E9%99%A4%E5%A4%A7%E6%B3%95%E2%80%94%E2%80%94%E6%95%B4%E4%B8%AA%E4%B8%96%E7%95%8C%E6%B8%85%E5%87%80%E4%BA%86/">React/Antd Warning移除大法——整个世界清净了</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-05-14T10:41:14.000Z">2020-05-14</time></p><p class="title"><a href="/2020/05/14/IntersectionObserver/">IntersectionObserver</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-02-06T13:45:55.000Z">2020-02-06</time></p><p class="title"><a href="/2020/02/06/%E5%BE%AE%E5%B1%81%E6%81%A9%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B9%8B-%E2%80%94%E2%80%94-V2Ray/">微屁恩使用指南之 —— V2Ray</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-10T07:45:26.000Z">2019-12-10</time></p><p class="title"><a href="/2019/12/10/H5%E5%9C%A8%E5%85%A8%E5%B1%8FWebview%E4%B8%AD%E5%8F%8C%E7%AB%AF%E9%80%82%E9%85%8D%E5%88%98%E6%B5%B7%E5%B1%8F/">H5在全屏Webview中双端适配刘海屏</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-07-25T09:58:45.000Z">2019-07-25</time></p><p class="title"><a href="/2019/07/25/vue-%E9%A1%B9%E7%9B%AE%E5%9C%A8%E4%BD%8E%E9%85%8D%E6%9C%BA%E5%99%A8%E4%B8%8A%E7%BA%BF%E5%8F%8A%E4%BC%98%E5%8C%96/">vue 项目在低配机器上线及优化</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">October 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">September 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">March 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">March 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">December 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">November 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">October 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">September 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">August 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/07/"><span class="level-start"><span class="level-item">July 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">February 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">December 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">November 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">October 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">September 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">August 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">July 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/06/"><span class="level-start"><span class="level-item">June 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">May 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">April 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/03/"><span class="level-start"><span class="level-item">March 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/02/"><span class="level-start"><span class="level-item">February 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/01/"><span class="level-start"><span class="level-item">January 2015</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">December 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">November 2014</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">October 2014</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">September 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">August 2014</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/07/"><span class="level-start"><span class="level-item">July 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/06/"><span class="level-start"><span class="level-item">June 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/05/"><span class="level-start"><span class="level-item">May 2014</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/04/"><span class="level-start"><span class="level-item">April 2014</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/03/"><span class="level-start"><span class="level-item">March 2014</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/02/"><span class="level-start"><span class="level-item">February 2014</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">January 2014</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/12/"><span class="level-start"><span class="level-item">December 2013</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/11/"><span class="level-start"><span class="level-item">November 2013</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">October 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Flutter/"><span class="tag">Flutter</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ghost/"><span class="tag">Ghost</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/H5/"><span class="tag">H5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HTTPS/"><span class="tag">HTTPS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mac/"><span class="tag">Mac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React-Native/"><span class="tag">React Native</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sublime/"><span class="tag">Sublime</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jQuery/"><span class="tag">jQuery</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/npm/"><span class="tag">npm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%88%AC%E8%99%AB/"><span class="tag">爬虫</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E8%A7%86%E5%89%A7/"><span class="tag">电视剧</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BE%8E%E9%A3%9F/"><span class="tag">美食</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E7%AC%94/"><span class="tag">随笔</span><span class="tag">3</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/facvion.png" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2021 Ludis</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">京ICP备19027325号-2</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/flute"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>