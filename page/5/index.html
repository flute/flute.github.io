<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Ludis"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Ludis"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="https://ldsun.com/"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://ldsun.com/img/og_image.png"><meta property="article:author" content="Ludis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ldsun.com"},"headline":"Hexo","image":["https://ldsun.com/img/og_image.png"],"author":{"@type":"Person","name":"Ludis"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"https://ldsun.com/img/facvion.png"}},"description":""}</script><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/facvion.png" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/flute"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-12-27T20:23:09.000Z" title="12/28/2016, 4:23:09 AM">2016-12-28</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-12-27T20:36:12.000Z" title="12/28/2016, 4:36:12 AM">2016-12-28</time></span><span class="level-item">6 minutes read (About 974 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/12/28/%E5%9F%BA%E4%BA%8Enodejs%E7%9A%84%E9%97%AE%E5%8D%B7%E8%B0%83%E6%9F%A5%E7%B3%BB%E7%BB%9F/">基于nodejs的问卷调查系统</a></h1><div class="content"><p>花了4天时间撸了一个问卷调查系统，算是入门nodejs后端开发。</p>
<p>github传送门：<a target="_blank" rel="noopener" href="https://github.com/flute/survey">https://github.com/flute/survey</a></p>
<h3 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h3><ul>
<li>后端：nodejs+express+mysql</li>
<li>前端：material design</li>
</ul>
<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><ol>
<li><code>npm install</code></li>
<li>配置数据库 <code>conf/db.js</code> ，导入sql文件 <code>mysql.sql</code></li>
<li><code>node app.js</code></li>
</ol>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ol>
<li>登陆验证</li>
<li>问题类型包括 单选、多选及问答三类</li>
<li>查看问卷列表、删除</li>
<li>填写提交问卷</li>
<li>问卷结果列表及结果详情</li>
</ol>
<h4 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h4><p>在系统实现过程中，数据表的设计及数据操作有些麻烦，感兴趣的往下看：</p>
<p>为了问卷结果的可读性及统计方便，数据表设计时将 问卷、问题、选项 分为三个表，在插入、读取问卷时，需要顺序、批量进行数据库操作。</p>
<p>如：新增1个问卷，该问卷有10个问题，单选及多选问题包含2个以上的选项。</p>
<p>那么数据操作顺序是：</p>
<ol>
<li>先插入问卷，并得到返回的问卷ID。</li>
<li>得到问卷ID，按顺序插入10个问题，每个问题在插入成功后，返回问题ID。</li>
<li>每个问题插入成功时得到问题ID，按顺序插入该问题的多个选项，只有当该问题及问题选项全部插入成功时，开始执行下个问题。</li>
</ol>
<p>可以看到3是2中的内部循环，2本身是个循环，1和2是顺序执行关系。对于这样的数据插入，如果用常规的嵌套回调，光一个问题就是三层以上的嵌套，几十个问题的话就没法玩了。而且所有的操作只需要一个返回结果，及最终成功与否，只要当其中任何一次插入失败则失败。</p>
<p>最终实现方法是使用<code>async.eachSeries</code>，以下代码实现上述问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">insertSurvey: <span class="function"><span class="keyword">function</span> (<span class="params">data,callback</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//从mysql连接池获取连接</span></span><br><span class="line">	pool.getConnection(<span class="function"><span class="keyword">function</span>(<span class="params">err,connection</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( err )&#123;</span><br><span class="line">			callback(err);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		connection.query( <span class="string">&quot;insert into t_survey(... , ... ,...) values(..., ...)&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(res)&#123;</span><br><span class="line">				<span class="comment">//问卷插入成功</span></span><br><span class="line">				<span class="keyword">var</span> surveyId = res.insertId;</span><br><span class="line">				<span class="comment">//异步批量按序插入问题</span></span><br><span class="line">				<span class="comment">//拼接sql数组</span></span><br><span class="line">				&#123;...&#125;</span><br><span class="line">				<span class="comment">/**</span></span><br><span class="line"><span class="comment">				 * insertQuestionSql 是插入问题的语句数组</span></span><br><span class="line"><span class="comment">				 * </span></span><br><span class="line"><span class="comment">				 * insertQuestionSql = [</span></span><br><span class="line"><span class="comment">				 * 		insert into t_survey_question(createAt,type,.....) values(... ,.. , ...),</span></span><br><span class="line"><span class="comment">				 * 		insert into t_survey_question(createAt,type,.....) values(... ,.. , ...),</span></span><br><span class="line"><span class="comment">				 * 		.....</span></span><br><span class="line"><span class="comment">				 * ];</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">				<span class="keyword">async</span>.eachSeries( insertQuestionSql, <span class="function"><span class="keyword">function</span>(<span class="params">item,questioncb</span>)</span>&#123;</span><br><span class="line">					connection.query( item.survey, <span class="function"><span class="keyword">function</span>(<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">						<span class="keyword">if</span>(err) &#123;</span><br><span class="line">							questioncb(err,result);</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="comment">//问题插入成功，继续插入选项</span></span><br><span class="line">							<span class="keyword">var</span> questionId = results.insertId;</span><br><span class="line">							<span class="comment">//如果是单选或多选，存在多个选项，异步批量按序插入选项</span></span><br><span class="line">							<span class="comment">//拼接sql数组</span></span><br><span class="line">							&#123;...&#125;</span><br><span class="line">							<span class="comment">/**</span></span><br><span class="line"><span class="comment">							 * insertOptionSql 是需要插入的选项数组</span></span><br><span class="line"><span class="comment">							 * </span></span><br><span class="line"><span class="comment">							 * insertOptionSql = [</span></span><br><span class="line"><span class="comment">							 * 		insert into t_survey_option(createAt,type,.....) values(... ,.. , ...),</span></span><br><span class="line"><span class="comment">							 * 		insert into t_survey_option(createAt,type,.....) values(... ,.. , ...),</span></span><br><span class="line"><span class="comment">							 * 		.....</span></span><br><span class="line"><span class="comment">							 * ];</span></span><br><span class="line"><span class="comment">							 */</span></span><br><span class="line">							<span class="keyword">if</span>( item.data.type == <span class="string">&#x27;radio&#x27;</span> || item.data.type == <span class="string">&#x27;checkbox&#x27;</span> )&#123;</span><br><span class="line">								<span class="keyword">async</span>.eachSeries( insertOptionSql, <span class="function"><span class="keyword">function</span>(<span class="params"> optionitem, optioncb </span>)</span>&#123;</span><br><span class="line">									connection.query( optionitem, <span class="function"><span class="keyword">function</span>(<span class="params"> operror,opresult</span>)</span>&#123;</span><br><span class="line">										<span class="keyword">if</span>(operror)&#123;</span><br><span class="line">											optioncb(operror,opresult);</span><br><span class="line">										&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">											<span class="comment">//选项插入成功</span></span><br><span class="line">											optioncb( opresult.insertId );</span><br><span class="line">										&#125;</span><br><span class="line">									&#125;);</span><br><span class="line">								&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">									<span class="comment">//当前问题的所有选项插入结束</span></span><br><span class="line">									<span class="keyword">if</span>(err)&#123;</span><br><span class="line">										callback(err);</span><br><span class="line">									&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">										callback();</span><br><span class="line">									&#125;</span><br><span class="line">								&#125;);</span><br><span class="line">							&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">								<span class="comment">//问答无选项，直接回调</span></span><br><span class="line">								questioncb();</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">					<span class="comment">//所有问题插入结束</span></span><br><span class="line">					callback(err);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(err)&#123;</span><br><span class="line">				callback(err)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//回调结果</span></span><br><span class="line">			callback(result);</span><br><span class="line">			<span class="comment">//释放连接 </span></span><br><span class="line">            connection.release();</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>最终的解决方案也是三层嵌套回调，也对应了对三个表的操作，暂时算是最优解决方案了。</p>
<p><code>async.eachSeries</code> 保证了SQL的执行顺序，而且当其中一条执行异常，就不会继续执行下一条，简单示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sqls = [</span><br><span class="line">  <span class="string">&quot;INSERT INTO log SET data=&#x27;data1&#x27;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;INSERT INTO log SET data=&#x27;data2&#x27;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;INSERT INTO log SET data=&#x27;data3&#x27;&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>.eachSeries(sqls, <span class="function"><span class="keyword">function</span>(<span class="params">item, callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 遍历每条SQL并执行</span></span><br><span class="line">  connection.query(item, <span class="function"><span class="keyword">function</span>(<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      <span class="comment">// 异常后调用callback并传入err</span></span><br><span class="line">      callback(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(item + <span class="string">&quot;执行成功&quot;</span>);</span><br><span class="line">      <span class="comment">// 执行完成后也要调用callback，不需要参数</span></span><br><span class="line">      callback();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 所有SQL执行完成后回调</span></span><br><span class="line">  <span class="keyword">if</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;SQL全部执行成功&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-11-28T18:41:39.000Z" title="11/29/2016, 2:41:39 AM">2016-11-29</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-11-28T18:41:39.000Z" title="11/29/2016, 2:41:39 AM">2016-11-29</time></span><span class="level-item">2 minutes read (About 350 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/11/29/Echarts3-%E4%B8%AD%E5%9B%BD%E5%9C%B0%E5%9B%BE%E4%B8%8B%E9%92%BB%E8%87%B3%E5%8E%BF%E7%BA%A7/">Echarts3 中国地图下钻至县级</a></h1><div class="content"><h1 id="Echarts3-地图下钻至县级"><a href="#Echarts3-地图下钻至县级" class="headerlink" title="Echarts3 地图下钻至县级"></a>Echarts3 地图下钻至县级</h1><p>看了会D3.js，鉴于学习曲线较高，且要实现的效果不复杂，遂使用Echarts完成——中国地图下钻至县级。</p>
<p>HTML</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>echarts3中国地图下钻至县级<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;static/css/main.css&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Echarts3 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/js/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 全国344个市、区、州对应的数字编号 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/js/citymap.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;height:800px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/js/app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//地图容器</span></span><br><span class="line"><span class="keyword">var</span> chart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;main&#x27;</span>));</span><br><span class="line"><span class="comment">//34个省、市、自治区的名字拼音映射数组</span></span><br><span class="line"><span class="keyword">var</span> provinces = &#123;</span><br><span class="line">    <span class="comment">//23个省</span></span><br><span class="line">    <span class="string">&quot;台湾&quot;</span>: <span class="string">&quot;taiwan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;河北&quot;</span>: <span class="string">&quot;hebei&quot;</span>,</span><br><span class="line">    <span class="string">&quot;山西&quot;</span>: <span class="string">&quot;shanxi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;辽宁&quot;</span>: <span class="string">&quot;liaoning&quot;</span>,</span><br><span class="line">    <span class="string">&quot;吉林&quot;</span>: <span class="string">&quot;jilin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;黑龙江&quot;</span>: <span class="string">&quot;heilongjiang&quot;</span>,</span><br><span class="line">    <span class="string">&quot;江苏&quot;</span>: <span class="string">&quot;jiangsu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;浙江&quot;</span>: <span class="string">&quot;zhejiang&quot;</span>,</span><br><span class="line">    <span class="string">&quot;安徽&quot;</span>: <span class="string">&quot;anhui&quot;</span>,</span><br><span class="line">    <span class="string">&quot;福建&quot;</span>: <span class="string">&quot;fujian&quot;</span>,</span><br><span class="line">    <span class="string">&quot;江西&quot;</span>: <span class="string">&quot;jiangxi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;山东&quot;</span>: <span class="string">&quot;shandong&quot;</span>,</span><br><span class="line">    <span class="string">&quot;河南&quot;</span>: <span class="string">&quot;henan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;湖北&quot;</span>: <span class="string">&quot;hubei&quot;</span>,</span><br><span class="line">    <span class="string">&quot;湖南&quot;</span>: <span class="string">&quot;hunan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;广东&quot;</span>: <span class="string">&quot;guangdong&quot;</span>,</span><br><span class="line">    <span class="string">&quot;海南&quot;</span>: <span class="string">&quot;hainan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;四川&quot;</span>: <span class="string">&quot;sichuan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;贵州&quot;</span>: <span class="string">&quot;guizhou&quot;</span>,</span><br><span class="line">    <span class="string">&quot;云南&quot;</span>: <span class="string">&quot;yunnan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;陕西&quot;</span>: <span class="string">&quot;shanxi1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;甘肃&quot;</span>: <span class="string">&quot;gansu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;青海&quot;</span>: <span class="string">&quot;qinghai&quot;</span>,</span><br><span class="line">    <span class="comment">//5个自治区</span></span><br><span class="line">    <span class="string">&quot;新疆&quot;</span>: <span class="string">&quot;xinjiang&quot;</span>,</span><br><span class="line">    <span class="string">&quot;广西&quot;</span>: <span class="string">&quot;guangxi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;内蒙古&quot;</span>: <span class="string">&quot;neimenggu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;宁夏&quot;</span>: <span class="string">&quot;ningxia&quot;</span>,</span><br><span class="line">    <span class="string">&quot;西藏&quot;</span>: <span class="string">&quot;xizang&quot;</span>,</span><br><span class="line">    <span class="comment">//4个直辖市</span></span><br><span class="line">    <span class="string">&quot;北京&quot;</span>: <span class="string">&quot;beijing&quot;</span>,</span><br><span class="line">    <span class="string">&quot;天津&quot;</span>: <span class="string">&quot;tianjin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;上海&quot;</span>: <span class="string">&quot;shanghai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;重庆&quot;</span>: <span class="string">&quot;chongqing&quot;</span>,</span><br><span class="line">    <span class="comment">//2个特别行政区</span></span><br><span class="line">    <span class="string">&quot;香港&quot;</span>: <span class="string">&quot;xianggang&quot;</span>,</span><br><span class="line">    <span class="string">&quot;澳门&quot;</span>: <span class="string">&quot;aomen&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//直辖市和特别行政区-只有二级地图，没有三级地图</span></span><br><span class="line"><span class="keyword">var</span> special = [<span class="string">&quot;北京&quot;</span>,<span class="string">&quot;天津&quot;</span>,<span class="string">&quot;上海&quot;</span>,<span class="string">&quot;重庆&quot;</span>,<span class="string">&quot;香港&quot;</span>,<span class="string">&quot;澳门&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> mapdata = [];</span><br><span class="line"><span class="comment">//绘制全国地图</span></span><br><span class="line">$.getJSON(<span class="string">&#x27;static/map/china.json&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">	d = [];</span><br><span class="line">	<span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.features.length;i++ )&#123;</span><br><span class="line">		d.push(&#123;</span><br><span class="line">			<span class="attr">name</span>:data.features[i].properties.name</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	mapdata = d;</span><br><span class="line">	<span class="comment">//注册地图</span></span><br><span class="line">	echarts.registerMap(<span class="string">&#x27;china&#x27;</span>, data);</span><br><span class="line">	<span class="comment">//绘制地图</span></span><br><span class="line">	renderMap(<span class="string">&#x27;china&#x27;</span>,d);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//地图点击事件</span></span><br><span class="line">chart.on(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log( params );</span><br><span class="line">	<span class="keyword">if</span>( params.name <span class="keyword">in</span> provinces )&#123;</span><br><span class="line">		<span class="comment">//如果点击的是34个省、市、自治区，绘制选中地区的二级地图</span></span><br><span class="line">		$.getJSON(<span class="string">&#x27;static/map/province/&#x27;</span>+ provinces[params.name] +<span class="string">&#x27;.json&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">			echarts.registerMap( params.name, data);</span><br><span class="line">			<span class="keyword">var</span> d = [];</span><br><span class="line">			<span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.features.length;i++ )&#123;</span><br><span class="line">				d.push(&#123;</span><br><span class="line">					<span class="attr">name</span>:data.features[i].properties.name</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;</span><br><span class="line">			renderMap(params.name,d);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>( params.seriesName <span class="keyword">in</span> provinces )&#123;</span><br><span class="line">		<span class="comment">//如果是【直辖市/特别行政区】只有二级下钻</span></span><br><span class="line">		<span class="keyword">if</span>(  special.indexOf( params.seriesName ) &gt;=<span class="number">0</span>  )&#123;</span><br><span class="line">			renderMap(<span class="string">&#x27;china&#x27;</span>,mapdata);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//显示县级地图</span></span><br><span class="line">			$.getJSON(<span class="string">&#x27;static/map/city/&#x27;</span>+ cityMap[params.name] +<span class="string">&#x27;.json&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">				echarts.registerMap( params.name, data);</span><br><span class="line">				<span class="keyword">var</span> d = [];</span><br><span class="line">				<span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.features.length;i++ )&#123;</span><br><span class="line">					d.push(&#123;</span><br><span class="line">						<span class="attr">name</span>:data.features[i].properties.name</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;</span><br><span class="line">				renderMap(params.name,d);</span><br><span class="line">			&#125;);	</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		renderMap(<span class="string">&#x27;china&#x27;</span>,mapdata);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化配置</span></span><br><span class="line"><span class="keyword">var</span> option = &#123;</span><br><span class="line">	<span class="attr">backgroundColor</span>: <span class="string">&#x27;#000&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span> : &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;Echarts3 中国地图下钻至县级&#x27;</span>,</span><br><span class="line">        <span class="attr">subtext</span>: <span class="string">&#x27;三级下钻&#x27;</span>,</span><br><span class="line">        <span class="attr">link</span>:<span class="string">&#x27;http://www.ldsun.com&#x27;</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">textStyle</span>:&#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>:<span class="number">16</span>,</span><br><span class="line">            <span class="attr">fontWeight</span>:<span class="string">&#x27;normal&#x27;</span>,</span><br><span class="line">            <span class="attr">fontFamily</span>:<span class="string">&quot;Microsoft YaHei&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">subtextStyle</span>:&#123;</span><br><span class="line">        	<span class="attr">color</span>: <span class="string">&#x27;#ccc&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>:<span class="number">13</span>,</span><br><span class="line">            <span class="attr">fontWeight</span>:<span class="string">&#x27;normal&#x27;</span>,</span><br><span class="line">            <span class="attr">fontFamily</span>:<span class="string">&quot;Microsoft YaHei&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">tooltip</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">        <span class="attr">formatter</span>: <span class="string">&#x27;&#123;b&#125;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">toolbox</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">orient</span>: <span class="string">&#x27;vertical&#x27;</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">feature</span>: &#123;</span><br><span class="line">            <span class="attr">dataView</span>: &#123;<span class="attr">readOnly</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">            <span class="attr">restore</span>: &#123;&#125;,</span><br><span class="line">            <span class="attr">saveAsImage</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">iconStyle</span>:&#123;</span><br><span class="line">        	<span class="attr">normal</span>:&#123;</span><br><span class="line">        		<span class="attr">color</span>:<span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">animationDuration</span>:<span class="number">1000</span>,</span><br><span class="line">	<span class="attr">animationEasing</span>:<span class="string">&#x27;cubicOut&#x27;</span>,</span><br><span class="line">	<span class="attr">animationDurationUpdate</span>:<span class="number">1000</span></span><br><span class="line">     </span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//绘制地图</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderMap</span>(<span class="params">map,data</span>)</span>&#123;</span><br><span class="line">	option.title.subtext = map;</span><br><span class="line">    option.series = [ </span><br><span class="line">		&#123;</span><br><span class="line">            <span class="attr">name</span>: map,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;map&#x27;</span>,</span><br><span class="line">            <span class="attr">mapType</span>: map,</span><br><span class="line">            <span class="attr">roam</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">nameMap</span>:&#123;</span><br><span class="line">			    <span class="string">&#x27;china&#x27;</span>:<span class="string">&#x27;中国&#x27;</span></span><br><span class="line">			&#125;,</span><br><span class="line">            <span class="attr">label</span>: &#123;</span><br><span class="line">	            <span class="attr">normal</span>:&#123;</span><br><span class="line">					<span class="attr">show</span>:<span class="literal">true</span>,</span><br><span class="line">					<span class="attr">textStyle</span>:&#123;</span><br><span class="line">						<span class="attr">color</span>:<span class="string">&#x27;#999&#x27;</span>,</span><br><span class="line">						<span class="attr">fontSize</span>:<span class="number">13</span></span><br><span class="line">					&#125;  </span><br><span class="line">	            &#125;,</span><br><span class="line">	            <span class="attr">emphasis</span>: &#123;</span><br><span class="line">	                <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">	                <span class="attr">textStyle</span>:&#123;</span><br><span class="line">						<span class="attr">color</span>:<span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">						<span class="attr">fontSize</span>:<span class="number">13</span></span><br><span class="line">					&#125;</span><br><span class="line">	            &#125;</span><br><span class="line">	        &#125;,</span><br><span class="line">	        <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">	            <span class="attr">normal</span>: &#123;</span><br><span class="line">	                <span class="attr">areaColor</span>: <span class="string">&#x27;#323c48&#x27;</span>,</span><br><span class="line">	                <span class="attr">borderColor</span>: <span class="string">&#x27;dodgerblue&#x27;</span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            <span class="attr">emphasis</span>: &#123;</span><br><span class="line">	                <span class="attr">areaColor</span>: <span class="string">&#x27;darkorange&#x27;</span></span><br><span class="line">	            &#125;</span><br><span class="line">	        &#125;,</span><br><span class="line">            <span class="attr">data</span>:data</span><br><span class="line">        &#125;	</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">//渲染地图</span></span><br><span class="line">    chart.setOption(option);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>demo：<a target="_blank" rel="noopener" href="https://flute.github.io/echarts3-chinese-map-drill-down/">https://flute.github.io/echarts3-chinese-map-drill-down/</a></p>
<p>github:<a href="https://github.com/flute/echarts3-chinese-map-drill-down" target="_blank"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a></p>
<p>百度地图竟然不提供台湾地图的下载，2333….俨然是某台独派程序猿写的</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-10-30T19:36:29.000Z" title="10/31/2016, 3:36:29 AM">2016-10-31</time></span><span class="level-item">Updated&nbsp;<time dateTime="2018-12-10T09:06:45.000Z" title="12/10/2018, 5:06:45 PM">2018-12-10</time></span><span class="level-item">a minute read (About 222 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/10/31/background%E6%BB%A4%E9%95%9C%E6%95%88%E6%9E%9C%E5%8F%8A%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A/">background滤镜效果及高斯模糊</a></h1><div class="content"><h4 id="background滤镜效果"><a href="#background滤镜效果" class="headerlink" title="background滤镜效果"></a>background滤镜效果</h4><p>场景及实现：父级div嵌套子div，父div有背景图片，子div中有文字，需要实现背景图加黑色半透明遮罩，不影响子div中文字的显示效果。</p>
<p>CSS的<code>filter</code>滤镜效果的<code>Brightness</code>属性可以实现遮罩效果，但是类似于<code>opacity</code>属性，这种效果会影响子div的显示效果：<br><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ludis/ghost/images/filter-1.png"><br>解决方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;section1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#section1</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&#x27;../images/bg-img.jpg&#x27;</span>) center center no-repeat;</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#section1</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ludis/ghost/images/filter-2.png"></p>
<h4 id="模拟iOS实现高斯模糊效果"><a href="#模拟iOS实现高斯模糊效果" class="headerlink" title="模拟iOS实现高斯模糊效果"></a>模拟iOS实现高斯模糊效果</h4><p>使用filter的blur属性实现背景高斯模糊:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    -webkit-filter: blur(5px); /* Chrome, Safari, Opera */</span><br><span class="line">    filter: blur(5px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ludis/ghost/images/filter-3.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-10-12T23:45:15.000Z" title="10/13/2016, 7:45:15 AM">2016-10-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-10-30T20:12:56.000Z" title="10/31/2016, 4:12:56 AM">2016-10-31</time></span><span class="level-item">3 minutes read (About 463 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/10/13/Div-contenteditable-%E6%A8%A1%E6%8B%9F-textarea-%E5%8F%8A%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98/">Div+contenteditable 模拟 textarea 及存在的问题</a></h1><div class="content"><h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>在网页端实现聊天功能时，大多会采用textarea来实现，但是当需要在textarea中显示表情/图片时，就不好实现了。这时候普遍的方法是给<code>div</code>添加<code>contenteditable</code>属性，来模拟textarea，而在div中显示图片及表情就可以轻松实现了。</p>
<blockquote>
<p>The contenteditable global attribute is an enumerated attribute indicating if the element should be editable by the user. If so, the browser modifies its widget to allow editing. The attribute must take one of the following values:</p>
</blockquote>
<blockquote>
<ul>
<li>true or the empty string, which indicates that the element must be editable;</li>
</ul>
</blockquote>
<ul>
<li>false, which indicates that the element must not be editable.<br>If this attribute is not set, its default value is inherited from its parent element.</li>
</ul>
<h4 id="focus定位问题"><a href="#focus定位问题" class="headerlink" title="focus定位问题"></a>focus定位问题</h4><p>使用div模拟textarea后会发现一个问题，就是每次点击输入框或者使用<code>$(&#39;#tag&#39;).focus()</code>让输入框聚焦时，光标都会定位在最开始的位置。<br><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser">解决办法：</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">placeCaretAtEnd</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">    el.focus();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span>.getSelection != <span class="string">&quot;undefined&quot;</span></span><br><span class="line">            &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">document</span>.createRange != <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> range = <span class="built_in">document</span>.createRange();</span><br><span class="line">        range.selectNodeContents(el);</span><br><span class="line">        range.collapse(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">var</span> sel = <span class="built_in">window</span>.getSelection();</span><br><span class="line">        sel.removeAllRanges();</span><br><span class="line">        sel.addRange(range);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">document</span>.body.createTextRange != <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> textRange = <span class="built_in">document</span>.body.createTextRange();</span><br><span class="line">        textRange.moveToElementText(el);</span><br><span class="line">        textRange.collapse(<span class="literal">false</span>);</span><br><span class="line">        textRange.select();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">placeCaretAtEnd( <span class="built_in">document</span>.getElementById(<span class="string">&quot;content&quot;</span>) );</span><br></pre></td></tr></table></figure>
<h4 id="粘贴复制问题"><a href="#粘贴复制问题" class="headerlink" title="粘贴复制问题"></a>粘贴复制问题</h4><p>当使用div作为输入框时，你会发现，粘贴复制到的全是HTML结构，而我们想要的是粘贴复制纯文本，就像textarea那样。解决方法就是监听div的粘贴事件，然后在粘贴事件中匹配替换HTML元素，<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/15125217/convert-html-to-plain-text-in-contenteditable">返回纯文本：</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $plainText = $(<span class="string">&quot;#plainText&quot;</span>);</span><br><span class="line"></span><br><span class="line">$plainText.on(<span class="string">&#x27;paste&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $plainText.html(removeAllTags(replaceStyleAttr($plainText.html())));</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceStyleAttr</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/(&lt;[\w\W]*?)(style)([\w\W]*?&gt;)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c, d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b + <span class="string">&#x27;style_replace&#x27;</span> + d;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeTagsExcludeA</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/&lt;\/?((?!a)(\w+))\s*[\w\W]*?&gt;/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeAllTags</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/&lt;\/?(\w+)\s*[\w\W]*?&gt;/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-09-02T20:11:24.000Z" title="9/3/2016, 4:11:24 AM">2016-09-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-09-02T20:11:24.000Z" title="9/3/2016, 4:11:24 AM">2016-09-03</time></span><span class="level-item">a minute read (About 117 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/09/03/jQuery-%E7%9B%91%E5%90%AC%E9%9A%90%E8%97%8F%E8%A1%A8%E5%8D%95/">jQuery 监听隐藏表单</a></h1><div class="content"><p>设置了一个隐藏表单，其值由Ajax异步修改。前端需要实时监听该值，并由此进行相关操作。</p>
<p><code>&lt;input type=&quot;hidden&quot; value=&quot;&quot; id=&quot;datas&quot; name=&quot;datas&quot;&gt;</code></p>
<p>正常的表单可以使用 <code>.change()</code> 事件监听其 <code>value</code> 的改变，而隐藏表单其 <code>value</code> 改变时不会触发 <code>change()</code> 事件！</p>
<p>解决方法：</p>
<p>当为隐藏表单赋值后，使用 <code>trigger()</code> 手动触发 <code>change()</code> 事件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setValue</span>(<span class="params">ajaxData</span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;#datas&#x27;</span>).val(ajaxData).trigger(<span class="string">&#x27;change&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#datas&#x27;</span>).change()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;changed&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-08-02T17:21:21.000Z" title="8/3/2016, 1:21:21 AM">2016-08-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-08-02T17:27:32.000Z" title="8/3/2016, 1:27:32 AM">2016-08-03</time></span><span class="level-item">3 minutes read (About 445 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/08/03/React-Native-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%85%A2%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">React Native 初始化项目慢的解决办法</a></h1><div class="content"><p>初始化React Native：<code>react-native init ProjectName</code></p>
<p>由于墙的原因，即便开ss也会经常卡着不动。再次感谢方教授！</p>
<p>先看下NMP官网对 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/node-gyp">node-gyp</a> 的介绍</p>
<blockquote>
<h3 id="node-gyp"><a href="#node-gyp" class="headerlink" title="node-gyp"></a>node-gyp</h3></blockquote>
<blockquote>
<h4 id="Node-js-native-addon-build-tool"><a href="#Node-js-native-addon-build-tool" class="headerlink" title="Node.js native addon build tool"></a>Node.js native addon build tool</h4></blockquote>
<blockquote>
<p><code>node-gyp</code> is a cross-platform command-line tool written in Node.js for compiling native addon modules for Node.js. It &gt;bundles the <code>gyp</code> project used by the Chromium team and takes away the pain of dealing with the various differences in build platforms. It is the replacement to the <code>node-waf</code> program which is removed for node v0.8. If you have a native addon for node that still has a wscript file, then you should definitely add a binding.gyp file to support the latest versions of node.</p>
</blockquote>
<p>在初始化的过程中，<code>npm</code> 会下载源码然后使用 <code>node-gyp</code> 进行编译，而 node-gyp 编译时候需要 NodeJs 源码来提供头文件，所以它会先尝试下载 NodeJs 源码，而在天朝墙外 CDN 经常抽风，下载 NodeJs 源码奇慢无比，那么自然要卡很久。</p>
<p><strong>解决方法</strong>：先把 NodeJs 源码下载到本地，然后提取给 node-gyp。</p>
<p>terminal下（ nodejs 及 wget 自行安装 ）：</p>
<p><code>touch node-gyp.sh</code></p>
<p><code>vi node-gyp.sh</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># nodejs 版本号</span><br><span class="line">NODE_VERSION=`node -v | cut -d<span class="string">&#x27;v&#x27;</span> -<span class="keyword">f</span> <span class="number">2</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $&#123;NODE_VERSION&#125;</span><br><span class="line"></span><br><span class="line"># 下载源码包(淘宝镜像)</span><br><span class="line">wget http://npm.taobao.org/mirrors/node/v$NODE_VERSION/node-v$NODE_VERSION.tar.gz</span><br><span class="line"></span><br><span class="line"># 删除现有内容不完整的目录</span><br><span class="line">rm -rf ~/.node-gyp</span><br><span class="line"><span class="built_in">mkdir</span> ~/.node-gyp</span><br><span class="line"></span><br><span class="line"># 解压缩并重命名到正确格式</span><br><span class="line">tar zxf node-v$NODE_VERSION.tar.gz -C ~/.node-gyp</span><br><span class="line">mv ~/.node-gyp/node-v$NODE_VERSION ~/.node-gyp/$NODE_VERSION</span><br><span class="line"></span><br><span class="line"># 创建一个标记文件</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;9\n&quot;</span>&gt;~/.node-gyp/$NODE_VERSION/installVersion</span><br></pre></td></tr></table></figure>
<p>保存退出后执行 <code>bash node-gyp.sh</code></p>
<p>最后再替换 npm <a target="_blank" rel="noopener" href="http://registry.npm.taobao.org/">淘宝镜像</a><br>：</p>
<p><code>npm config set registry=http://registry.npm.taobao.org/</code></p>
<p>这样 React Native初始化会快很多。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-08-01T19:06:21.000Z" title="8/2/2016, 3:06:21 AM">2016-08-02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2018-12-10T09:08:55.000Z" title="12/10/2018, 5:08:55 PM">2018-12-10</time></span><span class="level-item">2 minutes read (About 321 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/08/02/Nodejs-%E7%88%AC%E8%99%AB%E4%BD%BF%E7%94%A8-eventproxy-%E6%8E%A7%E5%88%B6%E5%B9%B6%E5%8F%91/">Nodejs 爬虫使用 eventproxy 控制并发</a></h1><div class="content"><blockquote>
<p>use</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://visionmedia.github.io/superagent/">superagent</a> 抓取</li>
<li><a target="_blank" rel="noopener" href="https://github.com/cheeriojs/cheerio">cheerio</a> 解析</li>
<li><a target="_blank" rel="noopener" href="https://github.com/JacksonTian/eventproxy">eventproxy</a> 控制并发</li>
</ul>
<p>target url：<a target="_blank" rel="noopener" href="https://cnodejs.org/">https://cnodejs.org/</a></p>
<p><code>cd nodejs</code></p>
<p><code>mkdir test &amp;&amp; cd test</code></p>
<p><code>touch node.js</code></p>
<p>抓取其首页数据，共40篇文章。</p>
<ol>
<li>首先爬取首页篇文章的URL，将得到的40篇文章的URL存入数组articleUrlArr</li>
<li>然后爬取每篇文章的详细内容。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> eventproxy = <span class="built_in">require</span>(<span class="string">&#x27;eventproxy&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> superagent = <span class="built_in">require</span>(<span class="string">&#x27;superagent&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> articleUrlArr = [],</span><br><span class="line">    baseUrl = <span class="string">&#x27;https://cnodejs.org/&#x27;</span>;</span><br><span class="line"></span><br><span class="line">superagent.get(baseUrl).end(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> $ = cheerio.load(res.text);</span><br><span class="line">    <span class="comment">// 获取该页所有文章的链接</span></span><br><span class="line">    $(<span class="string">&#x27;#topic_list .topic_title&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">idx, elements</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> href = baseUrl+elements.attribs.href;</span><br><span class="line">        articleUrlArr.push(href);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//打印文章数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(articleUrlArr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ludis/nodejs.png" alt="https://ludis-1252396698.cos.ap-beijing.myqcloud.com/ludis/nodejs.png"><br>然后再分别爬取40篇文章的详细内容，即发出40个并发请求，同时爬取数据，调用eventproxy 的 <code>#after</code> API。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">articleUrlArr.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">  superagent.get(url).end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;fetch &#x27;</span> + url + <span class="string">&#x27; successful&#x27;</span>);</span><br><span class="line">      ep.emit(<span class="string">&#x27;task&#x27;</span>, [url, res.text]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">ep.after(<span class="string">&#x27;task&#x27;</span>, articleUrlArr.length, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// data为一个数组，包含了40次ep.emit(&#x27;task&#x27;, pair)中的pair</span></span><br><span class="line">    data = data.map(<span class="function"><span class="keyword">function</span> (<span class="params">topicPair</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 接下来都是 jquery 的用法了</span></span><br><span class="line">        <span class="keyword">var</span> url = topicPair[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> html = topicPair[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">var</span> $ = cheerio.load(html);</span><br><span class="line">        <span class="keyword">return</span> (&#123;</span><br><span class="line">            <span class="attr">title</span>: $(<span class="string">&#x27;.topic_full_title&#x27;</span>).text().trim(),</span><br><span class="line">            <span class="attr">href</span>: url,</span><br><span class="line">            <span class="attr">comment1</span>: $(<span class="string">&#x27;.reply_content&#x27;</span>).eq(<span class="number">0</span>).text().trim(),</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;final:&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-08-01T04:30:10.000Z" title="8/1/2016, 12:30:10 PM">2016-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-08-02T17:28:38.000Z" title="8/3/2016, 1:28:38 AM">2016-08-03</time></span><span class="level-item">4 minutes read (About 557 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/08/01/HTTPS%EF%BC%9A%E4%B8%BA-Ghost-%E8%AE%BE%E7%BD%AE-SSL-%E8%BF%9E%E6%8E%A5/">HTTPS：为 Ghost 设置 SSL 连接</a></h1><div class="content"><blockquote>
<p>HTTPS：超文本传输安全协议（Hypertext Transfer Protocol   Secure）是一种网络安全传输协议。在计算机网络上，HTTPS经由超文本传输协议进行通信，但利用SSL/TLS来对数据包进行加密。HTTPS开发的主要目的，是提供对网络服务器的身份认证，保护交换数据的隐私与完整性。</p>
</blockquote>
<blockquote>
<p>HTTPS连接经常被用于万维网上的交易支付和企业信息系统中敏感信息的传输。</p>
</blockquote>
<blockquote>
<h3 id="HTTPS-与-HTTP-的差异"><a href="#HTTPS-与-HTTP-的差异" class="headerlink" title="HTTPS 与 HTTP 的差异"></a>HTTPS 与 HTTP 的差异</h3><ul>
<li>与HTTP的URL由**<code>http://</code>** 起始且默认使用端口 <strong><code>80</code></strong> 不同，HTTPS的URL由**<code>https://</code>** 起始且默认使用端口**<code>443</code>**。</li>
</ul>
</blockquote>
<ul>
<li>HTTP是不安全的，且攻击者通过监听和中间人攻击等手段，可以获取网站帐户和敏感信息等。HTTPS被设计为可防止前述攻击，并（在没有使用旧版本的SSL时）被认为是安全的。<blockquote>
</blockquote>
<h3 id="Ghost设置SSL"><a href="#Ghost设置SSL" class="headerlink" title="Ghost设置SSL"></a>Ghost设置SSL</h3>首先申请SSL证书，可选择startSSL（免费一年）或自行购买。</li>
</ul>
<p>具体申请过程较为繁琐，自行search，得到crt证书及key</p>
<blockquote>
<p>环境：centos、nginx、nodejs、ghost</p>
</blockquote>
<p>ssh后执行：</p>
<ul>
<li><code>mkdir /etc/nginx/ssl</code></li>
<li><code>cp server.crt /etc/nginx/ssl/server.crt</code></li>
<li><code>cp server.key /etc/nginx/ssl/server.key</code></li>
</ul>
<p>将两个文件上传后，更新nginx配置：</p>
<ul>
<li>编辑配置文件，以自己实际位置为准 <code>vim /etc/nginx/conf.d/myconf.conf</code></li>
<li>修改server，监听443端口：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">     listen 80;</span><br><span class="line">+    listen 443 ssl;</span><br><span class="line">     server_name ldsun.com www.ldsun.com;</span><br><span class="line">+    ssl_certificate        /etc/nginx/ssl/ldsun.com.crt;</span><br><span class="line">+    ssl_certificate_key    /etc/nginx/ssl/ldsun.com.key;</span><br><span class="line">     ...</span><br><span class="line">     location / &#123;</span><br><span class="line">+       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">+       proxy_set_header Host $http_host;</span><br><span class="line">+       proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">        proxy_pass http://127.0.0.1:2368;</span><br><span class="line">        ...</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>重启nginx：<code>service nginx restart</code></p>
<h3 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h3><p> 从startSSL生成的key为加密key，每次重启nginx都需要输入密码解密，较为麻烦，也比较安全。可以直接将key文件解密，不用每次重启输入密码，相应的修改key文件权限即可保证安全性。</p>
<p>解密命令：<code>openssl rsa -in www.ldsun.com.key -out /etc/nginx/ssl/ldsun.com.key</code></p>
<p>设置文件权限：<code>chmod 600 ldsun.com.key</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-07-22T18:31:16.000Z" title="7/23/2016, 2:31:16 AM">2016-07-23</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-08-02T17:28:53.000Z" title="8/3/2016, 1:28:53 AM">2016-08-03</time></span><span class="level-item">4 minutes read (About 641 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/23/Ghost-%E5%AE%9E%E7%8E%B0%E6%96%87%E7%AB%A0%E5%BD%92%E6%A1%A3/">Ghost 实现文章归档</a></h1><div class="content"><p>Ghost系统目前暂不支持文章归档，遂手动实现。<br>方法：通过调用Ghost API实现</p>
<h3 id="启用ghost测试功能"><a href="#启用ghost测试功能" class="headerlink" title="启用ghost测试功能"></a>启用ghost测试功能</h3><p>进入ghost后台，在实验功能-&gt;启用测试功能能中开启测试功能，这样就可以使用Ghost API获取数据。</p>
<h3 id="新建自定义页面"><a href="#新建自定义页面" class="headerlink" title="新建自定义页面"></a>新建自定义页面</h3><ol>
<li>首先创建一个静态页面：在ghost后台新建页面，发布为 <em>独立页面</em> ，标题为archives，网址可以设置为<code>域名/archives</code></li>
<li>接着创建一个自定义页面模板：该模板是第一步创建的静态页面的模板，创建一个page-url.hbs模板，如果第一步设置的页面网址为<code>域名/archives</code>，那么模板即为<code>page-archives.hbs</code>。将该模板上传至<strong>主题根目录下</strong>即可，此时访问域名/archives，即会调用自定义的page-archives.hbs这个模板。（由于新建的模板没有任何内容，所以页面会显示为空，可以赋值page.hbs中的内容测试查看）<h3 id="调用Ghost-API实现文章归档"><a href="#调用Ghost-API实现文章归档" class="headerlink" title="调用Ghost API实现文章归档"></a>调用Ghost API实现文章归档</h3><blockquote>
<p>所需工具：<br /><br>jQuery、momentjs<br>文档：<br /><br>Ghost API文档：<a target="_blank" rel="noopener" href="http://api.ghost.org/v0.1/docs">http://api.ghost.org/v0.1/docs</a><br>Momentjs文档：<a target="_blank" rel="noopener" href="http://momentjs.cn/docs/">http://momentjs.cn/docs/</a><br>世界时区差计算：<a target="_blank" rel="noopener" href="http://www.12sign.cn/htmls/help/worldtimezone.htm">http://www.12sign.cn/htmls/help/worldtimezone.htm</a></p>
</blockquote>
</li>
</ol>
<p>在page-archives.hbs中调用Ghost API即可：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 调用ghost API，完成文章归档功能</span></span><br><span class="line"><span class="comment"> * 所需组件：jQuery、moment.js</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ldsun</span>.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">jQuery(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//获取所有文章数据，按照发表时间排列</span></span><br><span class="line">	$.get(ghost.url.api(<span class="string">&#x27;posts&#x27;</span>, &#123;</span><br><span class="line">		<span class="attr">limit</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">		<span class="attr">order</span>: <span class="string">&quot;published_at desc&quot;</span></span><br><span class="line">	&#125;)).done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> posts = data.posts;</span><br><span class="line">		<span class="keyword">var</span> count = posts.length;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">			<span class="comment">//调用comentjs对时间戳进行操作</span></span><br><span class="line">			<span class="comment">//由于ghost默认是CST时区，所以日期会有出入，这里消除时区差</span></span><br><span class="line">			<span class="keyword">var</span> time = moment(posts[i].published_at).utcOffset(<span class="string">&quot;-08:00&quot;</span>);</span><br><span class="line">			<span class="keyword">var</span> year = time.get(<span class="string">&#x27;y&#x27;</span>);</span><br><span class="line">			<span class="keyword">var</span> month = time.get(<span class="string">&#x27;M&#x27;</span>)+<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">var</span> date = time.get(<span class="string">&#x27;D&#x27;</span>);</span><br><span class="line">			<span class="keyword">if</span>( date&lt;<span class="number">10</span> ) date = <span class="string">&quot;0&quot;</span>+date;</span><br><span class="line">			<span class="keyword">var</span> title = posts[i].title;</span><br><span class="line">			<span class="keyword">var</span> url = <span class="string">&quot;http://www.ldsun.com&quot;</span>+posts[i].url;</span><br><span class="line">			<span class="comment">//首篇文章与其余文章分步操作</span></span><br><span class="line">			<span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">var</span> pre_month = moment(posts[i - <span class="number">1</span>].published_at).get(<span class="string">&#x27;month&#x27;</span>)+<span class="number">1</span>;</span><br><span class="line">				<span class="comment">//如果当前文章的发表月份与前篇文章发表月份相同，则在该月份ul下插入该文章</span></span><br><span class="line">				<span class="keyword">if</span> (month == pre_month) &#123;</span><br><span class="line">					<span class="keyword">var</span> html = <span class="string">&quot;&lt;li&gt;&lt;time&gt;&quot;</span>+date+<span class="string">&quot;日&lt;/time&gt;&lt;a href=&#x27;&quot;</span>+url+<span class="string">&quot;&#x27;&gt;&quot;</span>+title+<span class="string">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span>;</span><br><span class="line">					$(html).appendTo(<span class="string">&quot;.archives .list-&quot;</span>+year+<span class="string">&quot;-&quot;</span>+month);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//当月份不同时，插入新的月份</span></span><br><span class="line">				<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">var</span> html = <span class="string">&quot;&lt;div class=&#x27;item&#x27;&gt;&lt;h3&gt;&lt;i class=&#x27;fa fa-calendar fa-fw&#x27; aria-hidden=&#x27;true&#x27;&gt;&lt;/i&gt; &quot;</span>+year+<span class="string">&quot;-&quot;</span>+month+<span class="string">&quot;&lt;/h3&gt;&lt;ul class=&#x27;archives-list list-&quot;</span>+year+<span class="string">&quot;-&quot;</span>+month+<span class="string">&quot;&#x27;&gt;&lt;li&gt;&lt;time&gt;&quot;</span>+date+<span class="string">&quot;日&lt;/time&gt;&lt;a href=&#x27;&quot;</span>+url+<span class="string">&quot;&#x27;&gt;&quot;</span>+title+<span class="string">&quot;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">					$(html).appendTo(<span class="string">&#x27;.archives&#x27;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">var</span> html = <span class="string">&quot;&lt;div class=&#x27;item&#x27;&gt;&lt;h3&gt;&lt;i class=&#x27;fa fa-calendar fa-fw&#x27; aria-hidden=&#x27;true&#x27;&gt;&lt;/i&gt; &quot;</span>+year+<span class="string">&quot;-&quot;</span>+month+<span class="string">&quot;&lt;/h3&gt;&lt;ul class=&#x27;archives-list list-&quot;</span>+year+<span class="string">&quot;-&quot;</span>+month+<span class="string">&quot;&#x27;&gt;&lt;li&gt;&lt;time&gt;&quot;</span>+date+<span class="string">&quot;日&lt;/time&gt;&lt;a href=&#x27;&quot;</span>+url+<span class="string">&quot;&#x27;&gt;&quot;</span>+title+<span class="string">&quot;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">				$(html).appendTo(<span class="string">&#x27;.archives&#x27;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(err);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<p>效果可以进入archives页面查看：<a target="_blank" rel="noopener" href="http://www.ldsun.com/archives-post/">Archives</a></p>
<p>完整代码已上传至Git:<a href="https://github.com/flute/ghost-archives" target="_blank"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-07-20T20:56:39.000Z" title="7/21/2016, 4:56:39 AM">2016-07-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2016-08-08T19:56:29.000Z" title="8/9/2016, 3:56:29 AM">2016-08-09</time></span><span class="level-item">11 minutes read (About 1687 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/21/Wordpress-to-Ghost/">Wordpress to Ghost</a></h1><div class="content"><blockquote>
<p>环境：</p>
</blockquote>
<ul>
<li>Centos-6、Ngnix</li>
<li>Nodejs：v0.10.40</li>
<li>Npm：1.4.28</li>
<li>MySQL：5.1.73</li>
</ul>
<blockquote>
<p>前期准备</p>
</blockquote>
<p><code>yum update</code> 更新yum源</p>
<p><code>yum pdate</code> 更新yum源</p>
<p><code>yum groupinstall &quot;Development Tools&quot;</code> 安装开发工具包</p>
<blockquote>
<p>安装Nginx</p>
</blockquote>
<p>先编辑下Nginx的仓储地址，新建nginx.repo文件: </p>
<p><code>vi /etc/yum.repos.d/nginx.repo </code>在文件中写入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[nginx] </span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/ </span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>
<p>保存退出，然后使用yum下载Nginx，并安装： </p>
<p><code>sudo yum install nginx -y </code><br><code>sudo service nginx start</code> 开启nginx<br><code> sudo chkconfig nginx on </code> 设置nginx为开机启动 <br>这样Nginx的安装就完成了，在浏览器中输入VPS的IP或者域名就可以看见Nginx友好的提示：“Welcome to Nginx!”<br></p>
<blockquote>
<p>使用Nginx配置反向代理</p>
</blockquote>
<p>如果完成上一步并且在浏览器中看见Nginx的welcome，那么我们就可以开始配置反向代理，让代理从80端口指向2368端口 去到以下这个目录：<br><code> cd /etc/nginx/conf.d </code>删掉default.conf配置文件 <code>rm default.conf </code>在此目录下新建一个.conf文件，文件名随意<code> vi myself.conf </code>在文件中写入以下内容： </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> zyden.vicp.cc;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP $remote_addr;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host      $http_host;</span><br><span class="line">        <span class="attribute">proxy_pass</span>         http://127.0.0.1:2368;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> REMOTE-HOST $remote_addr;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For    $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将server_name换成自己的域名，或者ip，保存退出，并重启nginx: service nginx restart ok，nginx的问题就close file了</p>
<blockquote>
<p>安装配置Mysql</p>
</blockquote>
<p>Ghost v0.7.4 full (zh) 集成了sqlite3，不喜欢用Mysql的话可以忽略此步骤 :<br><code>yum install mysql mysql-server </code><br><code>service mysqld start</code> 启动mysql<br><code>mysql  chkconfig mysqld on </code>设置为开机启动 <br><code>mysql_secure_installation </code> 配置mysql 如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set root password? [Y/n] //设置root密码   -- 根据个人需求</span><br><span class="line">anonymous users? [Y/n] //删除匿名用户   -- y  </span><br><span class="line">Disallow root login remotely? [Y/n] //禁止root用户远程登录   --n  </span><br><span class="line">Remove test database and access to it? [Y/n] //删除默认的 test 数据库   --y  </span><br><span class="line">Reload privilege tables now? [Y/n] //是否马上应用最新的设置   --y</span><br></pre></td></tr></table></figure>
<p>为了支持中文，我们还要修改mysql的字符支持，编辑MySQL的配置文件：<code> vi /etc/my.cnf </code>在对应的位置加上对应的内容： </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-<span class="keyword">set</span>=utf8  </span><br><span class="line">[mysql]</span><br><span class="line">default-character-<span class="keyword">set</span>=utf8  </span><br><span class="line">[mysqld]</span><br><span class="line">character-<span class="keyword">set</span>-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br></pre></td></tr></table></figure>
<p>新建一个ghost专用的mysql用户和专用的database：</p>
<p><code>mysql -u root -p </code><br>//用root用户登录mysql</p>
<p><code>create database ghost;</code><br>//创建ghost数据库</p>
<p><code>GRANT ALL PRIVILEGES ON ghost.* To 'ghost'@'%' IDENTIFIED BY '密码';</code><br>//创建ghost database 和 用户名为ghost的用户</p>
<p>//%代表能被所有地址访问<br></p>
<blockquote>
<p>安装Node.js</p>
</blockquote>
<p>这里根据Ghost官方的建议，我们安装v0.10.40版本</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> wget http://nodejs.org/dist/v0.<span class="number">10.40</span>/node-v0.<span class="number">10.40</span>.tar.gz </span><br><span class="line">tar zxvf node-v0.<span class="number">10.40</span>.tar.gz <span class="keyword">cd</span> node-v0.<span class="number">10.40</span></span><br><span class="line"> ./configure <span class="keyword">m</span></span><br><span class="line"><span class="keyword">make</span> &amp;&amp; <span class="keyword">make</span> install</span><br></pre></td></tr></table></figure>
<blockquote>
<p>安装Ghost</p>
</blockquote>
<p>将ghost安装在/var/www下</p>
<p><code>cd /var/www </code>没有就创建该目录</p>
<p><code>wget <a target="_blank" rel="noopener" href="http://dl.ghostchina.com/Ghost-0.7.4-zh-full.zip">http://dl.ghostchina.com/Ghost-0.7.4-zh-full.zip</a></code>下载中文版的Ghost（原生版goole font会被墙，需要自己优化）</p>
<p>解压：</p>
<p><code>unzip -d ghost ghost-latest.zip</code></p>
<p>进入ghost安装目录：</p>
<p><code>cd ghost</code></p>
<p>安装Ghost：</p>
<p><code>sudo npm install --production</code><br>安装完成后可以通过如下命令启动ghost的开发模式，测试安装是否成功：<br><code>npm start</code><br>3.7.此时ghost将会运行在127.0.0.1:2368上，在浏览器中输入此地址即可访问。<br>这里要将config.example.js重命名为config.js再对其进行修改配置<br><code>mv config.example.js config.js</code><br><code>vi config.js</code><br>我们找到生产环境的配置：production</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">production: &#123;  </span><br><span class="line">    ur<span class="variable">l:</span> <span class="string">&#x27;www.ldsun.com&#x27;</span>, //这里是你自己VPS主机的域名，或者IP</span><br><span class="line">    mai<span class="variable">l:</span> &#123;&#125;,</span><br><span class="line">    database: &#123;</span><br><span class="line">        clien<span class="variable">t:</span> <span class="string">&#x27;mysql&#x27;</span>这里我选择使用mysql作为我博客的数据库</span><br><span class="line">        connection: &#123;</span><br><span class="line">            host     : <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">            user     : <span class="string">&#x27;ghost&#x27;</span>, //mysql用户名</span><br><span class="line">            password : <span class="string">&#x27;&#x27;</span>, //密码</span><br><span class="line">            database : <span class="string">&#x27;ghost&#x27;</span>, //之前创建的ghost数据库名称</span><br><span class="line">            charset  : <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    server: &#123;</span><br><span class="line">            hos<span class="variable">t:</span> <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">            por<span class="variable">t:</span> <span class="string">&#x27;2368&#x27;</span>//若修改该端口记得在nginx中做相应改变</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>用命令<code>npm start</code>来试试启动开发者模式的Ghost，启动后在浏览器输入自己blog地址如果能看见Ghost。至此ghost安装成功！</p>
<blockquote>
<p>使用PM2让Ghost永远在线</p>
</blockquote>
<p>只要一断开ssh，Ghost的进程就会被关闭，这里使用PM2来守护Ghost服务进程，并让其运行在生产模式production上</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//进到ghost的安装目录</span><br><span class="line">cd /var/www/ghost</span><br><span class="line">//安装pm2</span><br><span class="line">npm install pm2 -g</span><br><span class="line">//让ghost以production模式运作，指定程序的入口index.js，并且此进程命名为ghost</span><br><span class="line">NODE<span class="built_in">_</span>ENV=production pm2 start index.js --name &quot;ghost&quot;</span><br><span class="line">//开机启动</span><br><span class="line">pm2 startup centos</span><br><span class="line">//保存设置</span><br><span class="line">pm2 save</span><br></pre></td></tr></table></figure>
<p>这样进程守护就完成了，ghost会永远在线，并且会伴随vps重启运行，几个常见命令如下：</p>
<p><code>pm2 restart 进程名</code> 重启进程</p>
<p><code>pm2 list</code> 或 <code>pm2 status</code> 查看运行的进程</p>
<p><code>pm2 show 进程名/进程ID</code> 查看进程详情</p>
<blockquote>
<p>数据转移</p>
</blockquote>
<p>wp搜索“Ghost”插件，或手动<a target="_blank" rel="noopener" href="https://github.com/TryGhost/wp-ghost-exporter">下载</a><br>经测试，1M左右的wp-posts数据表用该插件可以导出为ghost可用的json文件，我的wp-posts数据表接近3M，没有成功导出过，最后自己写个脚本跑出来即可。</p>
<blockquote>
<p>图片处理</p>
</blockquote>
<p>图片迁移我是选择将原wp的所有图片传到七牛，然后给nginx写rewrite规则。</p>
<p>wp的图片存在wp-content/uploads中，将所有图片下载下来。</p>
<p>注册七牛账号，新建一个Bucket仓库，下载上传所用<a target="_blank" rel="noopener" href="http://devtools.qiniu.com/qrsboxcli-darwin_adm64-current">命令行工具</a></p>
<p>切换到该工具的目录下，执行初始化：</p>
<p><code>./qrsboxcli init &lt;AccessKey&gt; &lt;SecretKey&gt; &lt;SyncDir&gt; &lt;Bucket&gt; [&lt;KeyPrefix&gt;]</code></p>
<ul>
<li>AccessKey、SecretKey可进入个人中心查看</li>
<li>SyncDir 是本地的同步目录，该目录下的文件会随时同步上传值七牛云存储。</li>
<li>Bucket 是保存同步文件的资源空间名。</li>
<li>KeyPrefix 是文件前缀，可选。如果设置了该参数，那么上传的文件名前都会加上前缀。这个前缀主要用于在空间中区分不同上传来源的文件。</li>
</ul>
<p>然后使用以下命令开始文件同步：</p>
<p><code>./qrsboxcli sync &amp;</code></p>
<p>查看进程：</p>
<p><code>./qrsboxcli log</code></p>
<p>终止进程：</p>
<p><code>./qrsboxcli stop</code></p>
<blockquote>
<p>设置Nginx Rewrite规则</p>
</blockquote>
<p>图片上传到七牛之后，配置nginx.conf。打开之前创建的.conf文件：</p>
<p><code>vim /etc/nginx/conf.d/myself.conf</code></p>
<p>由于wp文章中的图片请求都是wp-content/uploads/year/month/*.(jpg|png|gif)，所以可以按照如下规则rewrite图片地址：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /<span class="keyword">wp</span>-content/ &#123;</span><br><span class="line">  <span class="keyword">if</span> (!-<span class="keyword">e</span> $request_filename) &#123;</span><br><span class="line">  	rewrite ^/<span class="keyword">wp</span>-content/uploads/(.*)$ http://<span class="number">7</span>xqpve.com1.z0.glb.clouddn.<span class="keyword">com</span>/$<span class="number">1</span> <span class="keyword">last</span>; </span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存，重启nginx服务即可。</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/4/">Previous</a></div><div class="pagination-next"><a href="/page/6/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><a class="pagination-link is-current" href="/page/5/">5</a></li><li><a class="pagination-link" href="/page/6/">6</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/18/">18</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://img.ikstatic.cn/MTYzMTE3MTU3NDM3MCM1MzYjcG5n.png" alt="Ludis"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Ludis</p><p class="is-size-6 is-block">Valar Morghulis, Valar Dohaeris</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">177</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">17</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/flute" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/flute"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/3852099619"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:552452006@qq.com"><i class="far fa-envelope"></i></a></div></div></div><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-30T07:42:16.000Z">2021-06-30</time></p><p class="title"><a href="/2021/06/30/React-Antd-Warning%E7%A7%BB%E9%99%A4%E5%A4%A7%E6%B3%95%E2%80%94%E2%80%94%E6%95%B4%E4%B8%AA%E4%B8%96%E7%95%8C%E6%B8%85%E5%87%80%E4%BA%86/">React/Antd Warning移除大法——整个世界清净了</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-05-14T10:41:14.000Z">2020-05-14</time></p><p class="title"><a href="/2020/05/14/IntersectionObserver/">IntersectionObserver</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-02-06T13:45:55.000Z">2020-02-06</time></p><p class="title"><a href="/2020/02/06/%E5%BE%AE%E5%B1%81%E6%81%A9%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B9%8B-%E2%80%94%E2%80%94-V2Ray/">微屁恩使用指南之 —— V2Ray</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-10T07:45:26.000Z">2019-12-10</time></p><p class="title"><a href="/2019/12/10/H5%E5%9C%A8%E5%85%A8%E5%B1%8FWebview%E4%B8%AD%E5%8F%8C%E7%AB%AF%E9%80%82%E9%85%8D%E5%88%98%E6%B5%B7%E5%B1%8F/">H5在全屏Webview中双端适配刘海屏</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-07-25T09:58:45.000Z">2019-07-25</time></p><p class="title"><a href="/2019/07/25/vue-%E9%A1%B9%E7%9B%AE%E5%9C%A8%E4%BD%8E%E9%85%8D%E6%9C%BA%E5%99%A8%E4%B8%8A%E7%BA%BF%E5%8F%8A%E4%BC%98%E5%8C%96/">vue 项目在低配机器上线及优化</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">October 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">September 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">March 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">March 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">December 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">November 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">October 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/09/"><span class="level-start"><span class="level-item">September 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">August 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/07/"><span class="level-start"><span class="level-item">July 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">February 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">December 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">November 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">October 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">September 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">August 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">July 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/06/"><span class="level-start"><span class="level-item">June 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">May 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">April 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/03/"><span class="level-start"><span class="level-item">March 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/02/"><span class="level-start"><span class="level-item">February 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/01/"><span class="level-start"><span class="level-item">January 2015</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">December 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">November 2014</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">October 2014</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">September 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">August 2014</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/07/"><span class="level-start"><span class="level-item">July 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/06/"><span class="level-start"><span class="level-item">June 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/05/"><span class="level-start"><span class="level-item">May 2014</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/04/"><span class="level-start"><span class="level-item">April 2014</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/03/"><span class="level-start"><span class="level-item">March 2014</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/02/"><span class="level-start"><span class="level-item">February 2014</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">January 2014</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/12/"><span class="level-start"><span class="level-item">December 2013</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/11/"><span class="level-start"><span class="level-item">November 2013</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">October 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Flutter/"><span class="tag">Flutter</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ghost/"><span class="tag">Ghost</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/H5/"><span class="tag">H5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HTTPS/"><span class="tag">HTTPS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mac/"><span class="tag">Mac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React-Native/"><span class="tag">React Native</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sublime/"><span class="tag">Sublime</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/html/"><span class="tag">html</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jQuery/"><span class="tag">jQuery</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/npm/"><span class="tag">npm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%88%AC%E8%99%AB/"><span class="tag">爬虫</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E8%A7%86%E5%89%A7/"><span class="tag">电视剧</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BE%8E%E9%A3%9F/"><span class="tag">美食</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E7%AC%94/"><span class="tag">随笔</span><span class="tag">3</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/facvion.png" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2021 Ludis</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">京ICP备19027325号-2</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/flute"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>